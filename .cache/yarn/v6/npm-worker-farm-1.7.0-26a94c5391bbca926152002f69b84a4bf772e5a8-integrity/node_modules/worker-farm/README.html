
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Worker Farm &#8212; Spatial Analysis for Energy</title>
    
  <link rel="stylesheet" href="../../../../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/language_data.js"></script>
    <script src="../../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../../../../index.html">
  
  <img src="../../../../../../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Spatial Analysis for Energy</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Intro.html">
   UCL Energy Systems &amp; Data Analytics - Spatial Module
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/03-Working-with-Vector-Data.html">
   Working with Vector Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/04-Working-with-Raster-Data.html">
   Working with Raster Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extensions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../extensions/01-Mapping-with-ggplot.html">
   Mapping with ggplot
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Setup.html">
   Set-Up Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Jupyter-Anaconda.html">
   What is Jupyter/Anaconda?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/ESDA%20Course.html">
   ESDA Course
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../../../_sources/.cache/yarn/v6/npm-worker-farm-1.7.0-26a94c5391bbca926152002f69b84a4bf772e5a8-integrity/node_modules/worker-farm/README.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   Example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-estimating-using-child-workers">
     Example #1: Estimating π using child workers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#durability">
   Durability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#my-use-case">
   My use-case
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api">
   API
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#workerfarm-options-pathtomodule-exportedmethods">
     workerFarm([options, ]pathToModule[, exportedMethods])
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exportedmethods">
       <code class="docutils literal notranslate">
        <span class="pre">
         exportedMethods
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#options">
       <code class="docutils literal notranslate">
        <span class="pre">
         options
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#workerfarm-end-farm">
     workerFarm.end(farm)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#related">
   Related
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#license">
   License
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="worker-farm-build-status">
<h1>Worker Farm <a class="reference external" href="http://travis-ci.org/rvagg/node-worker-farm"><img alt="Build Status" src="https://secure.travis-ci.org/rvagg/node-worker-farm.svg" /></a><a class="headerlink" href="#worker-farm-build-status" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://nodei.co/npm/worker-farm/"><img alt="NPM" src="https://nodei.co/npm/worker-farm.png?downloads=true&amp;downloadRank=true&amp;stars=true" /></a> <a class="reference external" href="https://nodei.co/npm/worker-farm/"><img alt="NPM" src="https://nodei.co/npm-dl/worker-farm.png?months=6&amp;height=3" /></a></p>
<p>Distribute processing tasks to child processes with an über-simple API and baked-in durability &amp; custom concurrency options. <em>Available in npm as <strong>worker-farm</strong></em>.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Given a file, <em>child.js</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">inp</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">inp</span> <span class="o">+</span> <span class="s1">&#39; BAR (&#39;</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And a main file:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">workerFarm</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;worker-farm&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">workers</span>    <span class="o">=</span> <span class="nx">workerFarm</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;./child&#39;</span><span class="p">))</span>
  <span class="p">,</span> <span class="nx">ret</span>        <span class="o">=</span> <span class="mf">0</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mf">10</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">workers</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39; FOO&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">outp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">outp</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">ret</span> <span class="o">==</span> <span class="mf">10</span><span class="p">)</span>
      <span class="nx">workerFarm</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">workers</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We’ll get an output something like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#1 FOO BAR (8546)</span>
<span class="c1">#0 FOO BAR (8545)</span>
<span class="c1">#8 FOO BAR (8545)</span>
<span class="c1">#9 FOO BAR (8546)</span>
<span class="c1">#2 FOO BAR (8548)</span>
<span class="c1">#4 FOO BAR (8551)</span>
<span class="c1">#3 FOO BAR (8549)</span>
<span class="c1">#6 FOO BAR (8555)</span>
<span class="c1">#5 FOO BAR (8553)</span>
<span class="c1">#7 FOO BAR (8557)</span>
</pre></div>
</div>
<p>This example is contained in the <em><a class="reference external" href="https://github.com/rvagg/node-worker-farm/tree/master/examples/basic/">examples/basic</a></em> directory.</p>
<div class="section" id="example-1-estimating-using-child-workers">
<h3>Example #1: Estimating π using child workers<a class="headerlink" href="#example-1-estimating-using-child-workers" title="Permalink to this headline">¶</a></h3>
<p>You will also find a more complex example in <em><a class="reference external" href="https://github.com/rvagg/node-worker-farm/tree/master/examples/pi/">examples/pi</a></em> that estimates the value of <strong>π</strong> by using a Monte Carlo <em>area-under-the-curve</em> method and compares the speed of doing it all in-process vs using child workers to complete separate portions.</p>
<p>Running <code class="docutils literal notranslate"><span class="pre">node</span> <span class="pre">examples/pi</span></code> will give you something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Doing it the slow (single-process) way...
π ≈ 3.1416269360000006  (0.0000342824102075312 away from actual!)
took 8341 milliseconds
Doing it the fast (multi-process) way...
π ≈ 3.1416233600000036  (0.00003070641021052367 away from actual!)
took 1985 milliseconds
</pre></div>
</div>
</div>
</div>
<div class="section" id="durability">
<h2>Durability<a class="headerlink" href="#durability" title="Permalink to this headline">¶</a></h2>
<p>An important feature of Worker Farm is <strong>call durability</strong>. If a child process dies for any reason during the execution of call(s), those calls will be re-queued and taken care of by other child processes. In this way, when you ask for something to be done, unless there is something <em>seriously</em> wrong with what you’re doing, you should get a result on your callback function.</p>
</div>
<div class="section" id="my-use-case">
<h2>My use-case<a class="headerlink" href="#my-use-case" title="Permalink to this headline">¶</a></h2>
<p>There are other libraries for managing worker processes available but my use-case was fairly specific: I need to make heavy use of the <a class="reference external" href="https://github.com/nearinfinity/node-java">node-java</a> library to interact with JVM code. Unfortunately, because the JVM garbage collector is so difficult to interact with, it’s prone to killing your Node process when the GC kicks under heavy load. For safety I needed a durable way to make calls so that (1) it wouldn’t kill my main process and (2) any calls that weren’t successful would be resubmitted for processing.</p>
<p>Worker Farm allows me to spin up multiple JVMs to be controlled by Node, and have a single, uncomplicated API that acts the same way as an in-process API and the calls will be taken care of by a child process even if an error kills a child process while it is working as the call will simply be passed to a new child process.</p>
<p><strong>But</strong>, don’t think that Worker Farm is specific to that use-case, it’s designed to be very generic and simple to adapt to anything requiring the use of child Node processes.</p>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>Worker Farm exports a main function and an <code class="docutils literal notranslate"><span class="pre">end()</span></code> method. The main function sets up a “farm” of coordinated child-process workers and it can be used to instantiate multiple farms, all operating independently.</p>
<div class="section" id="workerfarm-options-pathtomodule-exportedmethods">
<h3>workerFarm([options, ]pathToModule[, exportedMethods])<a class="headerlink" href="#workerfarm-options-pathtomodule-exportedmethods" title="Permalink to this headline">¶</a></h3>
<p>In its most basic form, you call <code class="docutils literal notranslate"><span class="pre">workerFarm()</span></code> with the path to a module file to be invoked by the child process. You should use an <strong>absolute path</strong> to the module file, the best way to obtain the path is with <code class="docutils literal notranslate"><span class="pre">require.resolve('./path/to/module')</span></code>, this function can be used in exactly the same way as <code class="docutils literal notranslate"><span class="pre">require('./path/to/module')</span></code> but it returns an absolute path.</p>
<div class="section" id="exportedmethods">
<h4><code class="docutils literal notranslate"><span class="pre">exportedMethods</span></code><a class="headerlink" href="#exportedmethods" title="Permalink to this headline">¶</a></h4>
<p>If your module exports a single function on <code class="docutils literal notranslate"><span class="pre">module.exports</span></code> then you should omit the final parameter. However, if you are exporting multiple functions on <code class="docutils literal notranslate"><span class="pre">module.exports</span></code> then you should list them in an Array of Strings:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">workers</span> <span class="o">=</span> <span class="nx">workerFarm</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;./mod&#39;</span><span class="p">),</span> <span class="p">[</span> <span class="s1">&#39;doSomething&#39;</span><span class="p">,</span> <span class="s1">&#39;doSomethingElse&#39;</span> <span class="p">])</span>
<span class="nx">workers</span><span class="p">.</span><span class="nx">doSomething</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{})</span>
<span class="nx">workers</span><span class="p">.</span><span class="nx">doSomethingElse</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{})</span>
</pre></div>
</div>
<p>Listing the available methods will instruct Worker Farm what API to provide you with on the returned object. If you don’t list a <code class="docutils literal notranslate"><span class="pre">exportedMethods</span></code> Array then you’ll get a single callable function to use; but if you list the available methods then you’ll get an object with callable functions by those names.</p>
<p><strong>It is assumed that each function you call on your child module will take a <code class="docutils literal notranslate"><span class="pre">callback</span></code> function as the last argument.</strong></p>
</div>
<div class="section" id="options">
<h4><code class="docutils literal notranslate"><span class="pre">options</span></code><a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h4>
<p>If you don’t provide an <code class="docutils literal notranslate"><span class="pre">options</span></code> object then the following defaults will be used:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nx">workerOptions</span>               <span class="o">:</span> <span class="p">{}</span>
  <span class="p">,</span> <span class="nx">maxCallsPerWorker</span>           <span class="o">:</span> <span class="kc">Infinity</span>
  <span class="p">,</span> <span class="nx">maxConcurrentWorkers</span>        <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">).</span><span class="nx">cpus</span><span class="p">().</span><span class="nx">length</span>
  <span class="p">,</span> <span class="nx">maxConcurrentCallsPerWorker</span> <span class="o">:</span> <span class="mf">10</span>
  <span class="p">,</span> <span class="nx">maxConcurrentCalls</span>          <span class="o">:</span> <span class="kc">Infinity</span>
  <span class="p">,</span> <span class="nx">maxCallTime</span>                 <span class="o">:</span> <span class="kc">Infinity</span>
  <span class="p">,</span> <span class="nx">maxRetries</span>                  <span class="o">:</span> <span class="kc">Infinity</span>
  <span class="p">,</span> <span class="nx">autoStart</span>                   <span class="o">:</span> <span class="kc">false</span>
  <span class="p">,</span> <span class="nx">onChild</span>                     <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong><code>workerOptions</code></strong> allows you to customize all the parameters passed to child nodes. This object supports <a class="reference external" href="https://nodejs.org/api/child_process.html#child_process_child_process_fork_modulepath_args_options">all possible options of <code class="docutils literal notranslate"><span class="pre">child_process.fork</span></code></a>. The default options passed are the parent <code class="docutils literal notranslate"><span class="pre">execArgv</span></code>, <code class="docutils literal notranslate"><span class="pre">cwd</span></code> and <code class="docutils literal notranslate"><span class="pre">env</span></code>. Any (or all) of them can be overridden, and others can be added as well.</p></li>
<li><p><strong><code>maxCallsPerWorker</code></strong> allows you to control the lifespan of your child processes. A positive number will indicate that you only want each child to accept that many calls before it is terminated. This may be useful if you need to control memory leaks or similar in child processes.</p></li>
<li><p><strong><code>maxConcurrentWorkers</code></strong> will set the number of child processes to maintain concurrently. By default it is set to the number of CPUs available on the current system, but it can be any reasonable number, including <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong><code>maxConcurrentCallsPerWorker</code></strong> allows you to control the <em>concurrency</em> of individual child processes. Calls are placed into a queue and farmed out to child processes according to the number of calls they are allowed to handle concurrently. It is arbitrarily set to 10 by default so that calls are shared relatively evenly across workers, however if your calls predictably take a similar amount of time then you could set it to <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> and Worker Farm won’t queue any calls but spread them evenly across child processes and let them go at it. If your calls aren’t I/O bound then it won’t matter what value you use here as the individual workers won’t be able to execute more than a single call at a time.</p></li>
<li><p><strong><code>maxConcurrentCalls</code></strong> allows you to control the maximum number of calls in the queue—either actively being processed or waiting for a worker to be processed. <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> indicates no limit but if you have conditions that may endlessly queue jobs and you need to set a limit then provide a <code class="docutils literal notranslate"><span class="pre">&gt;0</span></code> value and any calls that push the limit will return on their callback with a <code class="docutils literal notranslate"><span class="pre">MaxConcurrentCallsError</span></code> error (check <code class="docutils literal notranslate"><span class="pre">err.type</span> <span class="pre">==</span> <span class="pre">'MaxConcurrentCallsError'</span></code>).</p></li>
<li><p><strong><code>maxCallTime</code></strong> <em>(use with caution, understand what this does before you use it!)</em> when <code class="docutils literal notranslate"><span class="pre">!==</span> <span class="pre">Infinity</span></code>, will cap a time, in milliseconds, that <em>any single call</em> can take to execute in a worker. If this time limit is exceeded by just a single call then the worker running that call will be killed and any calls running on that worker will have their callbacks returned with a <code class="docutils literal notranslate"><span class="pre">TimeoutError</span></code> (check <code class="docutils literal notranslate"><span class="pre">err.type</span> <span class="pre">==</span> <span class="pre">'TimeoutError'</span></code>). If you are running with <code class="docutils literal notranslate"><span class="pre">maxConcurrentCallsPerWorker</span></code> value greater than <code class="docutils literal notranslate"><span class="pre">1</span></code> then <strong>all calls currently executing</strong> will fail and will be automatically resubmitted uless you’ve changed the <code class="docutils literal notranslate"><span class="pre">maxRetries</span></code> option. Use this if you have jobs that may potentially end in infinite loops that you can’t programatically end with your child code. Preferably run this with a <code class="docutils literal notranslate"><span class="pre">maxConcurrentCallsPerWorker</span></code> so you don’t interrupt other calls when you have a timeout. This timeout operates on a per-call basis but will interrupt a whole worker.</p></li>
<li><p><strong><code>maxRetries</code></strong> allows you to control the max number of call requeues after worker termination (unexpected or timeout). By default this option is set to <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> which means that each call of each terminated worker will always be auto requeued. When the number of retries exceeds <code class="docutils literal notranslate"><span class="pre">maxRetries</span></code> value, the job callback will be executed with a <code class="docutils literal notranslate"><span class="pre">ProcessTerminatedError</span></code>. Note that if you are running with finite <code class="docutils literal notranslate"><span class="pre">maxCallTime</span></code> and <code class="docutils literal notranslate"><span class="pre">maxConcurrentCallsPerWorkers</span></code> greater than <code class="docutils literal notranslate"><span class="pre">1</span></code> then any <code class="docutils literal notranslate"><span class="pre">TimeoutError</span></code> will increase the retries counter <em>for each</em> concurrent call of the terminated worker.</p></li>
<li><p><strong><code>autoStart</code></strong> when set to <code class="docutils literal notranslate"><span class="pre">true</span></code> will start the workers as early as possible. Use this when your workers have to do expensive initialization. That way they’ll be ready when the first request comes through.</p></li>
<li><p><strong><code>onChild</code></strong> when new child process starts this callback will be called with subprocess object as an argument. Use this when you need to add some custom communication with child processes.</p></li>
</ul>
</div>
</div>
<div class="section" id="workerfarm-end-farm">
<h3>workerFarm.end(farm)<a class="headerlink" href="#workerfarm-end-farm" title="Permalink to this headline">¶</a></h3>
<p>Child processes stay alive waiting for jobs indefinitely and your farm manager will stay alive managing its workers, so if you need it to stop then you have to do so explicitly. If you send your farm API to <code class="docutils literal notranslate"><span class="pre">workerFarm.end()</span></code> then it’ll cleanly end your worker processes. Note though that it’s a <em>soft</em> ending so it’ll wait for child processes to finish what they are working on before asking them to die.</p>
<p>Any calls that are queued and not yet being handled by a child process will be discarded. <code class="docutils literal notranslate"><span class="pre">end()</span></code> only waits for those currently in progress.</p>
<p>Once you end a farm, it won’t handle any more calls, so don’t even try!</p>
</div>
</div>
<div class="section" id="related">
<h2>Related<a class="headerlink" href="#related" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/Kikobeats/farm-cli">farm-cli</a> – Launch a farm of workers from CLI.</p></li>
</ul>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>Worker Farm is Copyright (c) 2014 Rod Vagg <a class="reference external" href="https://twitter.com/rvagg">&#64;rvagg</a> and licensed under the MIT license. All rights not explicitly granted in the MIT license are reserved. See the included LICENSE.md file for more details.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AyrtonB/ESDA-Spatial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./.cache/yarn/v6/npm-worker-farm-1.7.0-26a94c5391bbca926152002f69b84a4bf772e5a8-integrity/node_modules/worker-farm"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ayrton Bourn, Santiago De La Fuente, Clem Attwood, Joanna Kuleszo, Camilo Perico<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>