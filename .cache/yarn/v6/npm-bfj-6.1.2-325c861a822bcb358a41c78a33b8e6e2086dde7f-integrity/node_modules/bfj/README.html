
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BFJ &#8212; Spatial Analysis for Energy</title>
    
  <link rel="stylesheet" href="../../../../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/language_data.js"></script>
    <script src="../../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../../../../index.html">
  
  <img src="../../../../../../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Spatial Analysis for Energy</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Intro.html">
   UCL Energy Systems &amp; Data Analytics - Spatial Module
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/03-Working-with-Vector-Data.html">
   Working with Vector Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/04-Working-with-Raster-Data.html">
   Working with Raster Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extensions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../extensions/01-Mapping-with-ggplot.html">
   Mapping with ggplot
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Setup.html">
   Set-Up Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Jupyter-Anaconda.html">
   What is Jupyter/Anaconda?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/ESDA%20Course.html">
   ESDA Course
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../../../_sources/.cache/yarn/v6/npm-bfj-6.1.2-325c861a822bcb358a41c78a33b8e6e2086dde7f-integrity/node_modules/bfj/README.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-would-i-want-those">
   Why would I want those?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#is-it-fast">
   Is it fast?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-functions-does-it-implement">
   What functions does it implement?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-install-it">
   How do I install it?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-read-a-json-file">
   How do I read a JSON file?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-parse-a-stream-of-json">
   How do I parse a stream of JSON?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-selectively-parse-individual-items-from-a-json-stream">
   How do I selectively parse individual items from a JSON stream?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-write-a-json-file">
   How do I write a JSON file?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-create-a-stream-of-json">
   How do I create a stream of JSON?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-create-a-json-string">
   How do I create a JSON string?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-other-methods-are-there">
   What other methods are there?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bfj-walk-stream-options">
     bfj.walk (stream, options)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bfj-eventify-data-options">
     bfj.eventify (data, options)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-options-can-i-specify">
   What options can I specify?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options-for-parsing-functions">
     Options for parsing functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options-for-serialisation-functions">
     Options for serialisation functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#is-it-possible-to-pause-parsing-or-serialisation-from-calling-code">
   Is it possible to pause parsing or serialisation from calling code?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#can-it-handle-newline-delimited-json-ndjson">
   Can it handle newline-delimited JSON (NDJSON)?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-does-it-default-to-bluebird-promises">
   Why does it default to bluebird promises?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#can-i-specify-a-different-promise-implementation">
   Can I specify a different promise implementation?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#is-there-a-change-log">
   Is there a change log?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-do-i-set-up-the-dev-environment">
   How do I set up the dev environment?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-versions-of-node-js-does-it-support">
   What versions of Node.js does it support?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-license-is-it-released-under">
   What license is it released under?
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="bfj">
<h1>BFJ<a class="headerlink" href="#bfj" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://gitlab.com/philbooth/bfj/pipelines"><img alt="Build status" src="https://gitlab.com/philbooth/bfj/badges/master/pipeline.svg" /></a>
<a class="reference external" href="https://www.npmjs.com/package/bfj"><img alt="Package status" src="https://img.shields.io/npm/v/bfj.svg" /></a>
<a class="reference external" href="https://www.npmjs.com/package/bfj"><img alt="Downloads" src="https://img.shields.io/npm/dm/bfj.svg" /></a>
<a class="reference external" href="https://opensource.org/licenses/MIT"><img alt="License" src="https://img.shields.io/npm/l/bfj.svg" /></a></p>
<p>Big-Friendly JSON. Asynchronous streaming functions for large JSON data sets.</p>
<ul class="simple">
<li><p><a class="reference external" href="#why-would-i-want-those">Why would I want those?</a></p></li>
<li><p><a class="reference external" href="#is-it-fast">Is it fast?</a></p></li>
<li><p><a class="reference external" href="#what-functions-does-it-implement">What functions does it implement?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-install-it">How do I install it?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-read-a-json-file">How do I read a JSON file?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-parse-a-stream-of-json">How do I parse a stream of JSON?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-selectively-parse-individual-items-from-a-json-stream">How do I selectively parse individual items from a JSON stream?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-write-a-json-file">How do I write a JSON file?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-create-a-stream-of-json">How do I create a stream of JSON?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-create-a-json-string">How do I create a JSON string?</a></p></li>
<li><p><a class="reference external" href="#what-other-methods-are-there">What other methods are there?</a></p>
<ul>
<li><p><a class="reference external" href="#bfjwalk-stream-options">bfj.walk (stream, options)</a></p></li>
<li><p><a class="reference external" href="#bfjeventify-data-options">bfj.eventify (data, options)</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#what-options-can-i-specify">What options can I specify?</a></p>
<ul>
<li><p><a class="reference external" href="#options-for-parsing-functions">Options for parsing functions</a></p></li>
<li><p><a class="reference external" href="#options-for-serialisation-functions">Options for serialisation functions</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#is-it-possible-to-pause-parsing-or-serialisation-from-calling-code">Is it possible to pause parsing or serialisation from calling code?</a></p></li>
<li><p><a class="reference external" href="#can-it-handle-newline-delimited-json-ndjson">Can it handle newline-delimited JSON (NDJSON)?</a></p></li>
<li><p><a class="reference external" href="#why-does-it-default-to-bluebird-promises">Why does it default to bluebird promises?</a></p></li>
<li><p><a class="reference external" href="#can-i-specify-a-different-promise-implementation">Can I specify a different promise implementation?</a></p></li>
<li><p><a class="reference external" href="#is-there-a-change-log">Is there a change log?</a></p></li>
<li><p><a class="reference external" href="#how-do-i-set-up-the-dev-environment">How do I set up the dev environment?</a></p></li>
<li><p><a class="reference external" href="#what-versions-of-nodejs-does-it-support">What versions of Node.js does it support?</a></p></li>
<li><p><a class="reference external" href="#what-license-is-it-released-under">What license is it released under?</a></p></li>
</ul>
<div class="section" id="why-would-i-want-those">
<h2>Why would I want those?<a class="headerlink" href="#why-would-i-want-those" title="Permalink to this headline">¶</a></h2>
<p>If you need
to parse huge JSON strings
or stringify huge JavaScript data sets,
it monopolises the event loop
and can lead to out-of-memory exceptions.
BFJ implements asynchronous functions
and uses pre-allocated fixed-length arrays
to try and alleviate those issues.</p>
</div>
<div class="section" id="is-it-fast">
<h2>Is it fast?<a class="headerlink" href="#is-it-fast" title="Permalink to this headline">¶</a></h2>
<p>No.</p>
<p>BFJ yields frequently
to avoid monopolising the event loop,
interrupting its own execution
to let other event handlers run.
The frequency of those yields
can be controlled with the <a class="reference external" href="#what-options-can-i-specify"><code class="docutils literal notranslate"><span class="pre">yieldRate</span></code> option</a>,
but fundamentally it is not designed for speed.</p>
<p>Furthermore,
when serialising data to a stream,
BFJ uses a fixed-length buffer
to avoid exhausting available memory.
Whenever that buffer is full,
serialisation is paused
until the receiving stream processes some more data,
regardless of the value of <code class="docutils literal notranslate"><span class="pre">yieldRate</span></code>.
You can control the size of the buffer
using the <a class="reference external" href="#options-for-serialisation-functions"><code class="docutils literal notranslate"><span class="pre">bufferLength</span></code> option</a>
but really,
if you need quick results,
BFJ is not for you.</p>
</div>
<div class="section" id="what-functions-does-it-implement">
<h2>What functions does it implement?<a class="headerlink" href="#what-functions-does-it-implement" title="Permalink to this headline">¶</a></h2>
<p>Nine functions
are exported.</p>
<p>Five are
concerned with
parsing, or
turning JSON strings
into JavaScript data:</p>
<ul class="simple">
<li><p><a class="reference external" href="#how-do-i-read-a-json-file"><code class="docutils literal notranslate"><span class="pre">read</span></code></a>
asynchronously parses
a JSON file from disk.</p></li>
<li><p><a class="reference external" href="#how-do-i-parse-a-stream-of-json"><code class="docutils literal notranslate"><span class="pre">parse</span></code> and <code class="docutils literal notranslate"><span class="pre">unpipe</span></code></a>
are for asynchronously parsing
streams of JSON.</p></li>
<li><p><a class="reference external" href="#how-do-i-selectively-parse-individual-items-from-a-json-stream"><code class="docutils literal notranslate"><span class="pre">match</span></code></a>
selectively parses individual items
from a JSON stream.</p></li>
<li><p><a class="reference external" href="#bfjwalk-stream-options"><code class="docutils literal notranslate"><span class="pre">walk</span></code></a>
asynchronously walks
a stream,
emitting events
as it encounters
JSON tokens.
Analagous to a
<a class="reference external" href="http://en.wikipedia.org/wiki/Simple_API_for_XML">SAX parser</a>.</p></li>
</ul>
<p>The other four functions
handle the reverse transformations,
serialising
JavaScript data
to JSON:</p>
<ul class="simple">
<li><p><a class="reference external" href="#how-do-i-write-a-json-file"><code class="docutils literal notranslate"><span class="pre">write</span></code></a>
asynchronously serialises data
to a JSON file on disk.</p></li>
<li><p><a class="reference external" href="#how-do-i-create-a-stream-of-json"><code class="docutils literal notranslate"><span class="pre">streamify</span></code></a>
asynchronously serialises data
to a stream of JSON.</p></li>
<li><p><a class="reference external" href="#how-do-i-create-a-json-string"><code class="docutils literal notranslate"><span class="pre">stringify</span></code></a>
asynchronously serialises data
to a JSON string.</p></li>
<li><p><a class="reference external" href="#bfjeventify-data-options"><code class="docutils literal notranslate"><span class="pre">eventify</span></code></a>
asynchronously traverses
a data structure
depth-first,
emitting events
as it encounters items.
By default
it coerces
promises, buffers and iterables
to JSON-friendly values.</p></li>
</ul>
</div>
<div class="section" id="how-do-i-install-it">
<h2>How do I install it?<a class="headerlink" href="#how-do-i-install-it" title="Permalink to this headline">¶</a></h2>
<p>If you’re using npm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">i</span> <span class="n">bfj</span> <span class="o">--</span><span class="n">save</span>
</pre></div>
</div>
<p>Or if you just want
the git repo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@gitlab</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">philbooth</span><span class="o">/</span><span class="n">bfj</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-read-a-json-file">
<h2>How do I read a JSON file?<a class="headerlink" href="#how-do-i-read-a-json-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="nx">bfj</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read</span></code> returns a <a class="reference external" href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a> and
asynchronously parses
a JSON file
from disk.</p>
<p>It takes two arguments;
the path to the JSON file
and an <a class="reference external" href="#options-for-parsing-functions">options</a> object.</p>
<p>If there are
no syntax errors,
the returned promise is resolved
with the parsed data.
If syntax errors occur,
the promise is rejected
with the first error.</p>
</div>
<div class="section" id="how-do-i-parse-a-stream-of-json">
<h2>How do I parse a stream of JSON?<a class="headerlink" href="#how-do-i-parse-a-stream-of-json" title="Permalink to this headline">¶</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="c1">// By passing a readable stream to bfj.parse():</span>
<span class="nx">bfj</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>

<span class="c1">// ...or by passing the result from bfj.unpipe() to stream.pipe():</span>
<span class="nx">request</span><span class="p">({</span> <span class="nx">url</span> <span class="p">}).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">unpipe</span><span class="p">((</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">}</span>
<span class="p">}))</span>
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">parse</span></code> returns a <a class="reference external" href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a>
and asynchronously parses
a stream of JSON data.</p>
<p>It takes two arguments;
a <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
from which
the JSON
will be parsed
and an <a class="reference external" href="#options-for-parsing-functions">options</a> object.</p>
<p>If there are
no syntax errors,
the returned promise is resolved
with the parsed data.
If syntax errors occur,
the promise is rejected
with the first error.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unpipe</span></code> returns a <a class="reference external" href="https://nodejs.org/api/stream.html#stream_writable_streams">writable stream</a>
that can be passed to <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options"><code class="docutils literal notranslate"><span class="pre">stream.pipe</span></code></a>,
then parses JSON data
read from the stream.</p>
<p>It takes two arguments;
a callback function
that will be called
after parsing is complete
and an <a class="reference external" href="#options-for-parsing-functions">options</a> object.</p>
<p>If there are no errors,
the callback is invoked
with the result as the second argument.
If errors occur,
the first error is passed
the callback
as the first argument.</p>
</li>
</ul>
</div>
<div class="section" id="how-do-i-selectively-parse-individual-items-from-a-json-stream">
<h2>How do I selectively parse individual items from a JSON stream?<a class="headerlink" href="#how-do-i-selectively-parse-individual-items-from-a-json-stream" title="Permalink to this headline">¶</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="c1">// Call match with your stream and a selector predicate/regex/string</span>
<span class="kr">const</span> <span class="nx">dataStream</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">jsonStream</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="c1">// Get data out of the returned stream with event handlers</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;dataError&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>

<span class="c1">// ...or you can pipe it to another stream</span>
<span class="nx">dataStream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someOtherStream</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">match</span></code> returns a readable, object-mode stream
and asynchronously parses individual matching items
from an input JSON stream.</p>
<p>It takes three arguments:
a <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
from which the JSON will be parsed;
a selector argument for determining matches,
which may be a string, a regular expression or a predicate function;
and an <a class="reference external" href="#options-for-parsing-functions">options</a> object.</p>
<p>If the selector is a string,
it will be compared to property keys
to determine whether
each item in the data is a match.
If it is a regular expression,
the comparison will be made
by calling the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test">RegExp <code class="docutils literal notranslate"><span class="pre">test</span></code> method</a>
with the property key.
Predicate functions will be called with three arguments:
<code class="docutils literal notranslate"><span class="pre">key</span></code>, <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">depth</span></code>.
If the result of the predicate is a truthy value
then the item will be deemed a match.</p>
<p>If there are any syntax errors in the JSON,
a <code class="docutils literal notranslate"><span class="pre">dataError</span></code> event will be emitted.
If any other errors occur,
an <code class="docutils literal notranslate"><span class="pre">error</span></code> event will be emitted.</p>
</div>
<div class="section" id="how-do-i-write-a-json-file">
<h2>How do I write a JSON file?<a class="headerlink" href="#how-do-i-write-a-json-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="nx">bfj</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">write</span></code> returns a <a class="reference external" href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a>
and asynchronously serialises a data structure
to a JSON file on disk.
The promise is resolved
when the file has been written,
or rejected with the error
if writing failed.</p>
<p>It takes three arguments;
the path to the JSON file,
the data structure to serialise
and an <a class="reference external" href="#options-for-serialisation-functions">options</a> object.</p>
</div>
<div class="section" id="how-do-i-create-a-stream-of-json">
<h2>How do I create a stream of JSON?<a class="headerlink" href="#how-do-i-create-a-stream-of-json" title="Permalink to this headline">¶</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">streamify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="c1">// Get data out of the stream with event handlers</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">chunk</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;dataError&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span><span class="p">);</span>

<span class="c1">// ...or you can pipe it to another stream</span>
<span class="nx">stream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someOtherStream</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">streamify</span></code> returns a <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
and asynchronously serialises
a data structure to JSON,
pushing the result
to the returned stream.</p>
<p>It takes two arguments;
the data structure to serialise
and an <a class="reference external" href="#options-for-serialisation-functions">options</a> object.</p>
<p>If there a circular reference is encountered in the data
and <code class="docutils literal notranslate"><span class="pre">options.circular</span></code> is not set to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>,
a <code class="docutils literal notranslate"><span class="pre">dataError</span></code> event will be emitted.
If any other errors occur,
an <code class="docutils literal notranslate"><span class="pre">error</span></code> event will be emitted.</p>
</div>
<div class="section" id="how-do-i-create-a-json-string">
<h2>How do I create a JSON string?<a class="headerlink" href="#how-do-i-create-a-json-string" title="Permalink to this headline">¶</a></h2>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="nx">bfj</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// :(</span>
  <span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">stringify</span></code> returns a <a class="reference external" href="http://bluebirdjs.com/docs/api-reference.html">bluebird promise</a> and
asynchronously serialises a data structure
to a JSON string.
The promise is resolved
to the JSON string
when serialisation is complete.</p>
<p>It takes two arguments;
the data structure to serialise
and an <a class="reference external" href="#options-for-serialisation-functions">options</a> object.</p>
</div>
<div class="section" id="what-other-methods-are-there">
<h2>What other methods are there?<a class="headerlink" href="#what-other-methods-are-there" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bfj-walk-stream-options">
<h3>bfj.walk (stream, options)<a class="headerlink" href="#bfj-walk-stream-options" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">walk</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">array</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">property</span><span class="p">,</span> <span class="nx">name</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span> <span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span> <span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">literal</span><span class="p">,</span> <span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endArray</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endObject</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">dataError</span><span class="p">,</span> <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">walk</span></code> returns an <a class="reference external" href="https://nodejs.org/api/events.html#events_class_eventemitter">event emitter</a>
and asynchronously walks
a stream of JSON data,
emitting events
as it encounters
tokens.</p>
<p>It takes two arguments;
a <a class="reference external" href="https://nodejs.org/api/stream.html#stream_readable_streams">readable stream</a>
from which
the JSON
will be read
and an <a class="reference external" href="#options-for-parsing-functions">options</a> object.</p>
<p>The emitted events
are defined
as public properties
of an object,
<code class="docutils literal notranslate"><span class="pre">bfj.events</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.array</span></code>
indicates that
an array context
has been entered
by encountering
the <code class="docutils literal notranslate"><span class="pre">[</span></code> character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.endArray</span></code>
indicates that
an array context
has been left
by encountering
the <code class="docutils literal notranslate"><span class="pre">]</span></code> character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.object</span></code>
indicates that
an object context
has been entered
by encountering
the <code class="docutils literal notranslate"><span class="pre">{</span></code> character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.endObject</span></code>
indicates that
an object context
has been left
by encountering
the <code class="docutils literal notranslate"><span class="pre">}</span></code> character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.property</span></code>
indicates that
a property
has been encountered
in an object.
The listener
will be passed
the name of the property
as its argument
and the next event
to be emitted
will represent
the property’s value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.string</span></code>
indicates that
a string
has been encountered.
The listener
will be passed
the value
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.number</span></code>
indicates that
a number
has been encountered.
The listener
will be passed
the value
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.literal</span></code>
indicates that
a JSON literal
(either <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code> or <code class="docutils literal notranslate"><span class="pre">null</span></code>)
has been encountered.
The listener
will be passed
the value
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.error</span></code>
indicates that
an error was caught
from one of the event handlers
in user code.
The listener
will be passed
the <code class="docutils literal notranslate"><span class="pre">Error</span></code> instance
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.dataError</span></code>
indicates that
a syntax error was encountered
in the incoming JSON stream.
The listener
will be passed
an <code class="docutils literal notranslate"><span class="pre">Error</span></code> instance
decorated with <code class="docutils literal notranslate"><span class="pre">actual</span></code>, <code class="docutils literal notranslate"><span class="pre">expected</span></code>, <code class="docutils literal notranslate"><span class="pre">lineNumber</span></code> and <code class="docutils literal notranslate"><span class="pre">columnNumber</span></code> properties
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.end</span></code>
indicates that
the end of the input
has been reached
and the stream is closed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.endLine</span></code>
indicates that a root-level newline character
has been encountered in an <a class="reference external" href="#can-it-handle-newline-delimited-json-ndjson">NDJSON</a> stream.
Only emitted if the <code class="docutils literal notranslate"><span class="pre">ndjson</span></code> <a class="reference external" href="#options-for-parsing-functions">option</a> is set.</p></li>
</ul>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">bfj.walk</span></code>
to sequentially parse items in an array,
you might also be interested in
the <a class="reference external" href="https://github.com/hash-bang/bfj-collections">bfj-collections</a> module.</p>
</div>
<div class="section" id="bfj-eventify-data-options">
<h3>bfj.eventify (data, options)<a class="headerlink" href="#bfj-eventify-data-options" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">eventify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">array</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">object</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">property</span><span class="p">,</span> <span class="nx">name</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">string</span><span class="p">,</span> <span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">number</span><span class="p">,</span> <span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">literal</span><span class="p">,</span> <span class="nx">value</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endArray</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">endObject</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">dataError</span><span class="p">,</span> <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">emitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">bfj</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">end</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">eventify</span></code> returns an <a class="reference external" href="https://nodejs.org/api/events.html#events_class_eventemitter">event emitter</a>
and asynchronously traverses
a data structure depth-first,
emitting events as it
encounters items.
By default it coerces
promises, buffers and iterables
to JSON-friendly values.</p>
<p>It takes two arguments;
the data structure to traverse
and an <a class="reference external" href="#options-for-serialisation-functions">options</a> object.</p>
<p>The emitted events
are defined
as public properties
of an object,
<code class="docutils literal notranslate"><span class="pre">bfj.events</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.array</span></code>
indicates that
an array
has been encountered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.endArray</span></code>
indicates that
the end of an array
has been encountered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.object</span></code>
indicates that
an object
has been encountered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.endObject</span></code>
indicates that
the end of an object
has been encountered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.property</span></code>
indicates that
a property
has been encountered
in an object.
The listener
will be passed
the name of the property
as its argument
and the next event
to be emitted
will represent
the property’s value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.string</span></code>
indicates that
a string
has been encountered.
The listener
will be passed
the value
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.number</span></code>
indicates that
a number
has been encountered.
The listener
will be passed
the value
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.literal</span></code>
indicates that
a JSON literal
(either <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code> or <code class="docutils literal notranslate"><span class="pre">null</span></code>)
has been encountered.
The listener
will be passed
the value
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.error</span></code>
indicates that
an error was caught
from one of the event handlers
in user code.
The listener
will be passed
the <code class="docutils literal notranslate"><span class="pre">Error</span></code> instance
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.dataError</span></code>
indicates that
a circular reference was encountered in the data
and the <code class="docutils literal notranslate"><span class="pre">circular</span></code> option was not set to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>.
The listener
will be passed
an <code class="docutils literal notranslate"><span class="pre">Error</span></code> instance
as its argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.events.end</span></code>
indicates that
the end of the data
has been reached and
no further events
will be emitted.</p></li>
</ul>
</div>
</div>
<div class="section" id="what-options-can-i-specify">
<h2>What options can I specify?<a class="headerlink" href="#what-options-can-i-specify" title="Permalink to this headline">¶</a></h2>
<div class="section" id="options-for-parsing-functions">
<h3>Options for parsing functions<a class="headerlink" href="#options-for-parsing-functions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">options.reviver</span></code>:
Transformation function,
invoked depth-first
against the parsed
data structure.
This option
is analagous to the
<a class="reference external" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Using_the_reviver_parameter">reviver parameter for JSON.parse</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.yieldRate</span></code>:
The number of data items to process
before yielding to the event loop.
Smaller values yield to the event loop more frequently,
meaning less time will be consumed by bfj per tick
but the overall parsing time will be slower.
Larger values yield to the event loop less often,
meaning slower tick times but faster overall parsing time.
The default value is <code class="docutils literal notranslate"><span class="pre">16384</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.Promise</span></code>:
Promise constructor that will be used
for promises returned by all methods.
If you set this option,
please be aware that some promise implementations
(including native promises)
may cause your process to die
with out-of-memory exceptions.
Defaults to <a class="reference external" href="http://bluebirdjs.com/docs/api-reference.html">bluebird’s implementation</a>,
which does not have that problem.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.ndjson</span></code>:
If set to <code class="docutils literal notranslate"><span class="pre">true</span></code>,
newline characters at the root level
will be treated as delimiters between
discrete chunks of JSON.
See <a class="reference external" href="#can-it-handle-newline-delimited-json-ndjson">NDJSON</a> for more information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.numbers</span></code>:
For <code class="docutils literal notranslate"><span class="pre">bfj.match</span></code> only,
set this to <code class="docutils literal notranslate"><span class="pre">true</span></code>
if you wish to match against numbers
with a string or regular expression
<code class="docutils literal notranslate"><span class="pre">selector</span></code> argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.bufferLength</span></code>:
For <code class="docutils literal notranslate"><span class="pre">bfj.match</span></code> only,
the length of the match buffer.
Smaller values use less memory
but may result in a slower parse time.
The default value is <code class="docutils literal notranslate"><span class="pre">1024</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.highWaterMark</span></code>:
For <code class="docutils literal notranslate"><span class="pre">bfj.match</span></code> only,
set this if you would like to
pass a value for the <code class="docutils literal notranslate"><span class="pre">highWaterMark</span></code> option
to the readable stream constructor.</p></li>
</ul>
</div>
<div class="section" id="options-for-serialisation-functions">
<h3>Options for serialisation functions<a class="headerlink" href="#options-for-serialisation-functions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">options.space</span></code>:
Indentation string
or the number of spaces
to indent
each nested level by.
This option
is analagous to the
<a class="reference external" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument">space parameter for JSON.stringify</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.promises</span></code>:
By default,
promises are coerced
to their resolved value.
Set this property
to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>
for improved performance
if you don’t need
to coerce promises.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.buffers</span></code>:
By default,
buffers are coerced
using their <code class="docutils literal notranslate"><span class="pre">toString</span></code> method.
Set this property
to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>
for improved performance
if you don’t need
to coerce buffers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.maps</span></code>:
By default,
maps are coerced
to plain objects.
Set this property
to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>
for improved performance
if you don’t need
to coerce maps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.iterables</span></code>:
By default,
other iterables
(i.e. not arrays, strings or maps)
are coerced
to arrays.
Set this property
to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>
for improved performance
if you don’t need
to coerce iterables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.circular</span></code>:
By default,
circular references
will cause the write
to fail.
Set this property
to <code class="docutils literal notranslate"><span class="pre">'ignore'</span></code>
if you’d prefer
to silently skip past
circular references
in the data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.bufferLength</span></code>:
The length of the write buffer.
Smaller values use less memory
but may result in a slower serialisation time.
The default value is <code class="docutils literal notranslate"><span class="pre">1024</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.highWaterMark</span></code>:
Set this if you would like to
pass a value for the <code class="docutils literal notranslate"><span class="pre">highWaterMark</span></code> option
to the readable stream constructor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.yieldRate</span></code>:
The number of data items to process
before yielding to the event loop.
Smaller values yield to the event loop more frequently,
meaning less time will be consumed by bfj per tick
but the overall serialisation time will be slower.
Larger values yield to the event loop less often,
meaning slower tick times but faster overall serialisation time.
The default value is <code class="docutils literal notranslate"><span class="pre">16384</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options.Promise</span></code>:
Promise constructor that will be used
for promises returned by all methods.
If you set this option,
please be aware that some promise implementations
(including native promises)
may cause your process to die
with out-of-memory exceptions.
Defaults to <a class="reference external" href="http://bluebirdjs.com/docs/api-reference.html">bluebird’s implementation</a>,
which does not have that problem.</p></li>
</ul>
</div>
</div>
<div class="section" id="is-it-possible-to-pause-parsing-or-serialisation-from-calling-code">
<h2>Is it possible to pause parsing or serialisation from calling code?<a class="headerlink" href="#is-it-possible-to-pause-parsing-or-serialisation-from-calling-code" title="Permalink to this headline">¶</a></h2>
<p>Yes it is!
Both <a class="reference external" href="#bfjwalk-stream-options"><code class="docutils literal notranslate"><span class="pre">walk</span></code></a>
and <a class="reference external" href="#bfjeventify-data-options"><code class="docutils literal notranslate"><span class="pre">eventify</span></code></a>
decorate their returned event emitters
with a <code class="docutils literal notranslate"><span class="pre">pause</span></code> method
that will prevent any further events being emitted.
The <code class="docutils literal notranslate"><span class="pre">pause</span></code> method itself
returns a <code class="docutils literal notranslate"><span class="pre">resume</span></code> function
that you can call to indicate
that processing should continue.</p>
<p>For example:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">bfj</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bfj&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">emitter</span> <span class="o">=</span> <span class="nx">bfj</span><span class="p">.</span><span class="nx">walk</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">path</span><span class="p">),</span> <span class="nx">options</span><span class="p">);</span>

<span class="c1">// Later, when you want to pause parsing:</span>

<span class="kr">const</span> <span class="nx">resume</span> <span class="o">=</span> <span class="nx">emitter</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>

<span class="c1">// Then when you want to resume:</span>

<span class="nx">resume</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="can-it-handle-newline-delimited-json-ndjson">
<h2>Can it handle <a class="reference external" href="http://ndjson.org/">newline-delimited JSON (NDJSON)</a>?<a class="headerlink" href="#can-it-handle-newline-delimited-json-ndjson" title="Permalink to this headline">¶</a></h2>
<p>Yes.
If you pass the <code class="docutils literal notranslate"><span class="pre">ndjson</span></code> <a class="reference external" href="#options-for-parsing-functions">option</a>
to <code class="docutils literal notranslate"><span class="pre">bfj.walk</span></code>, <code class="docutils literal notranslate"><span class="pre">bfj.match</span></code> or <code class="docutils literal notranslate"><span class="pre">bfj.parse</span></code>,
newline characters at the root level
will act as delimiters between
discrete JSON values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.walk</span></code> will emit a <code class="docutils literal notranslate"><span class="pre">bfj.events.endLine</span></code> event
each time it encounters a newline character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.match</span></code> will just ignore the newlines
while it continues looking for matching items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bfj.parse</span></code> will resolve with the first value
and pause the underlying stream.
If it’s called again with the same stream,
it will resume processing
and resolve with the second value.
To parse the entire stream,
calls should be made sequentially one-at-a-time
until the returned promise
resolves to <code class="docutils literal notranslate"><span class="pre">undefined</span></code>
(<code class="docutils literal notranslate"><span class="pre">undefined</span></code> is not a valid JSON token).</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">bfj.unpipe</span></code> and <code class="docutils literal notranslate"><span class="pre">bfj.read</span></code> will not parse NDJSON.</p>
</div>
<div class="section" id="why-does-it-default-to-bluebird-promises">
<h2>Why does it default to bluebird promises?<a class="headerlink" href="#why-does-it-default-to-bluebird-promises" title="Permalink to this headline">¶</a></h2>
<p>Until version <code class="docutils literal notranslate"><span class="pre">4.2.4</span></code>,
native promises were used.
But they were found
to cause out-of-memory errors
when serialising large amounts of data to JSON,
due to <a class="reference external" href="https://alexn.org/blog/2017/10/11/javascript-promise-leaks-memory.html">well-documented problems
with the native promise implementation</a>.
So in version <code class="docutils literal notranslate"><span class="pre">5.0.0</span></code>,
bluebird promises were used instead.
In version <code class="docutils literal notranslate"><span class="pre">5.1.0</span></code>,
an option was added
that enables callers to specify
the promise constructor to use.
Use it at your own risk.</p>
</div>
<div class="section" id="can-i-specify-a-different-promise-implementation">
<h2>Can I specify a different promise implementation?<a class="headerlink" href="#can-i-specify-a-different-promise-implementation" title="Permalink to this headline">¶</a></h2>
<p>Yes.
Just pass the <code class="docutils literal notranslate"><span class="pre">Promise</span></code> option
to any method.
If you get out-of-memory errors
when using that option,
consider changing your promise implementation.</p>
</div>
<div class="section" id="is-there-a-change-log">
<h2>Is there a change log?<a class="headerlink" href="#is-there-a-change-log" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="HISTORY.html"><span class="doc std std-doc">Yes</span></a>.</p>
</div>
<div class="section" id="how-do-i-set-up-the-dev-environment">
<h2>How do I set up the dev environment?<a class="headerlink" href="#how-do-i-set-up-the-dev-environment" title="Permalink to this headline">¶</a></h2>
<p>The development environment
relies on <a class="reference external" href="https://nodejs.org/en/">Node.js</a>,
<a class="reference external" href="http://eslint.org/">ESLint</a>,
<a class="reference external" href="https://mochajs.org/">Mocha</a>,
<a class="reference external" href="http://chaijs.com/">Chai</a>,
<a class="reference external" href="https://github.com/thlorenz/proxyquire">Proxyquire</a> and
<a class="reference external" href="https://gitlab.com/philbooth/spooks.js">Spooks</a>.
Assuming that
you already have
node and NPM
set up,
you just need
to run
<code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code>
to install
all of the dependencies
as listed in <code class="docutils literal notranslate"><span class="pre">package.json</span></code>.</p>
<p>You can
lint the code
with the command
<code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">lint</span></code>.</p>
<p>You can
run the tests
with the command
<code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">test</span></code>.</p>
</div>
<div class="section" id="what-versions-of-node-js-does-it-support">
<h2>What versions of Node.js does it support?<a class="headerlink" href="#what-versions-of-node-js-does-it-support" title="Permalink to this headline">¶</a></h2>
<p>As of <a class="reference external" href="HISTORY.md#300">version <code class="docutils literal notranslate"><span class="pre">3.0.0</span></code></a>,
only Node.js versions 6 or greater
are supported
because of the dependency
on <a class="reference external" href="https://gitlab.com/philbooth/hoopy">Hoopy</a>.
Previous versions supported
node 4 and later.</p>
<p>A separate <code class="docutils literal notranslate"><span class="pre">node-4</span></code> branch was maintained
until version <code class="docutils literal notranslate"><span class="pre">5.4.1</span></code>,
which had feature parity version-for-version
with releases from <code class="docutils literal notranslate"><span class="pre">master</span></code>.
Releases from the <code class="docutils literal notranslate"><span class="pre">node-4</span></code> branch
are available in npm
under the package name <a class="reference external" href="https://www.npmjs.com/package/bfj-node4"><code class="docutils literal notranslate"><span class="pre">bfj-node4</span></code></a>.</p>
</div>
<div class="section" id="what-license-is-it-released-under">
<h2>What license is it released under?<a class="headerlink" href="#what-license-is-it-released-under" title="Permalink to this headline">¶</a></h2>
<p><span class="xref myst">MIT</span>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AyrtonB/ESDA-Spatial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./.cache/yarn/v6/npm-bfj-6.1.2-325c861a822bcb358a41c78a33b8e6e2086dde7f-integrity/node_modules/bfj"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ayrton Bourn, Santiago De La Fuente, Clem Attwood, Joanna Kuleszo, Camilo Perico<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>