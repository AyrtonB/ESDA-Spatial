
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Can I cache this? &#8212; Spatial Analysis for Energy</title>
    
  <link rel="stylesheet" href="../../../../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/language_data.js"></script>
    <script src="../../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../../../../index.html">
  
  <img src="../../../../../../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Spatial Analysis for Energy</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Intro.html">
   UCL Energy Systems &amp; Data Analytics - Spatial Module
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/03-Working-with-Vector-Data.html">
   Working with Vector Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/04-Working-with-Raster-Data.html">
   Working with Raster Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extensions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../extensions/01-Mapping-with-ggplot.html">
   Mapping with ggplot
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Setup.html">
   Set-Up Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Jupyter-Anaconda.html">
   What is Jupyter/Anaconda?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/ESDA%20Course.html">
   ESDA Course
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../../../_sources/.cache/yarn/v6/npm-http-cache-semantics-4.1.0-49e91c5cbf36c9b94bcfcd71c23d5249ec74e390-integrity/node_modules/http-cache-semantics/README.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Can I cache this?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#usage">
     Usage
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#constructor-options">
       Constructor options
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#storable">
       <code class="docutils literal notranslate">
        <span class="pre">
         storable()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#satisfieswithoutrevalidation-newrequest">
       <code class="docutils literal notranslate">
        <span class="pre">
         satisfiesWithoutRevalidation(newRequest)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#responseheaders">
       <code class="docutils literal notranslate">
        <span class="pre">
         responseHeaders()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#timetolive">
       <code class="docutils literal notranslate">
        <span class="pre">
         timeToLive()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#toobject-fromobject-json">
       <code class="docutils literal notranslate">
        <span class="pre">
         toObject()
        </span>
       </code>
       /
       <code class="docutils literal notranslate">
        <span class="pre">
         fromObject(json)
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#refreshing-stale-cache-revalidation">
       Refreshing stale cache (revalidation)
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#revalidationheaders-newrequest">
         <code class="docutils literal notranslate">
          <span class="pre">
           revalidationHeaders(newRequest)
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#revalidatedpolicy-revalidationrequest-revalidationresponse">
         <code class="docutils literal notranslate">
          <span class="pre">
           revalidatedPolicy(revalidationRequest,
          </span>
          <span class="pre">
           revalidationResponse)
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#yo-fresh">
   Yo, FRESH
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#used-by">
     Used by
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implemented">
     Implemented
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unimplemented">
     Unimplemented
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#trusting-server-date">
       Trusting server
       <code class="docutils literal notranslate">
        <span class="pre">
         Date
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="can-i-cache-this-build-status">
<h1>Can I cache this? <a class="reference external" href="https://travis-ci.org/kornelski/http-cache-semantics"><img alt="Build Status" src="https://travis-ci.org/kornelski/http-cache-semantics.svg?branch=master" /></a><a class="headerlink" href="#can-i-cache-this-build-status" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">CachePolicy</span></code> tells when responses can be reused from a cache, taking into account <a class="reference external" href="http://httpwg.org/specs/rfc7234.html">HTTP RFC 7234</a> rules for user agents and shared caches.
It also implements <a class="reference external" href="https://tools.ietf.org/html/rfc5861">RFC 5861</a>, implementing <code class="docutils literal notranslate"><span class="pre">stale-if-error</span></code> and <code class="docutils literal notranslate"><span class="pre">stale-while-revalidate</span></code>.
It’s aware of many tricky details such as the <code class="docutils literal notranslate"><span class="pre">Vary</span></code> header, proxy revalidation, and authenticated responses.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Cacheability of an HTTP response depends on how it was requested, so both <code class="docutils literal notranslate"><span class="pre">request</span></code> and <code class="docutils literal notranslate"><span class="pre">response</span></code> are required to create the policy.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">policy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CachePolicy</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">policy</span><span class="p">.</span><span class="nx">storable</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// throw the response away, it&#39;s not usable at all</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Cache the data AND the policy object in your cache</span>
<span class="c1">// (this is pseudocode, roll your own cache (lru-cache package works))</span>
<span class="nx">letsPretendThisIsSomeCache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
    <span class="p">{</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">response</span> <span class="p">},</span>
    <span class="nx">policy</span><span class="p">.</span><span class="nx">timeToLive</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// And later, when you receive a new request:</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">response</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">letsPretendThisIsSomeCache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">newRequest</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

<span class="c1">// It&#39;s not enough that it exists in the cache, it has to match the new request, too:</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">policy</span> <span class="o">&amp;&amp;</span> <span class="nx">policy</span><span class="p">.</span><span class="nx">satisfiesWithoutRevalidation</span><span class="p">(</span><span class="nx">newRequest</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// OK, the previous response can be used to respond to the `newRequest`.</span>
    <span class="c1">// Response headers have to be updated, e.g. to add Age and remove uncacheable headers.</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">policy</span><span class="p">.</span><span class="nx">responseHeaders</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It may be surprising, but it’s not enough for an HTTP response to be <a class="reference external" href="#yo-fresh">fresh</a> to satisfy a request. It may need to match request headers specified in <code class="docutils literal notranslate"><span class="pre">Vary</span></code>. Even a matching fresh response may still not be usable if the new request restricted cacheability, etc.</p>
<p>The key method is <code class="docutils literal notranslate"><span class="pre">satisfiesWithoutRevalidation(newRequest)</span></code>, which checks whether the <code class="docutils literal notranslate"><span class="pre">newRequest</span></code> is compatible with the original request and whether all caching conditions are met.</p>
<div class="section" id="constructor-options">
<h3>Constructor options<a class="headerlink" href="#constructor-options" title="Permalink to this headline">¶</a></h3>
<p>Request and response must have a <code class="docutils literal notranslate"><span class="pre">headers</span></code> property with all header names in lower case. <code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">status</span></code> and <code class="docutils literal notranslate"><span class="pre">method</span></code> are optional (defaults are any URL, status <code class="docutils literal notranslate"><span class="pre">200</span></code>, and <code class="docutils literal notranslate"><span class="pre">GET</span></code> method).</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">accept</span><span class="o">:</span> <span class="s1">&#39;*/*&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">status</span><span class="o">:</span> <span class="mf">200</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;cache-control&#39;</span><span class="o">:</span> <span class="s1">&#39;public, max-age=7234&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">shared</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">cacheHeuristic</span><span class="o">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="nx">immutableMinTimeToLive</span><span class="o">:</span> <span class="mf">24</span> <span class="o">*</span> <span class="mf">3600</span> <span class="o">*</span> <span class="mf">1000</span><span class="p">,</span> <span class="c1">// 24h</span>
    <span class="nx">ignoreCargoCult</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">options.shared</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> (default), then the response is evaluated from a perspective of a shared cache (i.e. <code class="docutils literal notranslate"><span class="pre">private</span></code> is not cacheable and <code class="docutils literal notranslate"><span class="pre">s-maxage</span></code> is respected). If <code class="docutils literal notranslate"><span class="pre">options.shared</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>, then the response is evaluated from a perspective of a single-user cache (i.e. <code class="docutils literal notranslate"><span class="pre">private</span></code> is cacheable and <code class="docutils literal notranslate"><span class="pre">s-maxage</span></code> is ignored). <code class="docutils literal notranslate"><span class="pre">shared:</span> <span class="pre">true</span></code> is recommended for HTTP clients.</p>
<p><code class="docutils literal notranslate"><span class="pre">options.cacheHeuristic</span></code> is a fraction of response’s age that is used as a fallback cache duration. The default is 0.1 (10%), e.g. if a file hasn’t been modified for 100 days, it’ll be cached for 100*0.1 = 10 days.</p>
<p><code class="docutils literal notranslate"><span class="pre">options.immutableMinTimeToLive</span></code> is a number of milliseconds to assume as the default time to cache responses with <code class="docutils literal notranslate"><span class="pre">Cache-Control:</span> <span class="pre">immutable</span></code>. Note that <a class="reference external" href="http://httpwg.org/http-extensions/immutable.html">per RFC</a> these can become stale, so <code class="docutils literal notranslate"><span class="pre">max-age</span></code> still overrides the default.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">options.ignoreCargoCult</span></code> is true, common anti-cache directives will be completely ignored if the non-standard <code class="docutils literal notranslate"><span class="pre">pre-check</span></code> and <code class="docutils literal notranslate"><span class="pre">post-check</span></code> directives are present. These two useless directives are most commonly found in bad StackOverflow answers and PHP’s “session limiter” defaults.</p>
</div>
<div class="section" id="storable">
<h3><code class="docutils literal notranslate"><span class="pre">storable()</span></code><a class="headerlink" href="#storable" title="Permalink to this headline">¶</a></h3>
<p>Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the response can be stored in a cache. If it’s <code class="docutils literal notranslate"><span class="pre">false</span></code> then you MUST NOT store either the request or the response.</p>
</div>
<div class="section" id="satisfieswithoutrevalidation-newrequest">
<h3><code class="docutils literal notranslate"><span class="pre">satisfiesWithoutRevalidation(newRequest)</span></code><a class="headerlink" href="#satisfieswithoutrevalidation-newrequest" title="Permalink to this headline">¶</a></h3>
<p>This is the most important method. Use this method to check whether the cached response is still fresh in the context of the new request.</p>
<p>If it returns <code class="docutils literal notranslate"><span class="pre">true</span></code>, then the given <code class="docutils literal notranslate"><span class="pre">request</span></code> matches the original response this cache policy has been created with, and the response can be reused without contacting the server. Note that the old response can’t be returned without being updated, see <code class="docutils literal notranslate"><span class="pre">responseHeaders()</span></code>.</p>
<p>If it returns <code class="docutils literal notranslate"><span class="pre">false</span></code>, then the response may not be matching at all (e.g. it’s for a different URL or method), or may require to be refreshed first (see <code class="docutils literal notranslate"><span class="pre">revalidationHeaders()</span></code>).</p>
</div>
<div class="section" id="responseheaders">
<h3><code class="docutils literal notranslate"><span class="pre">responseHeaders()</span></code><a class="headerlink" href="#responseheaders" title="Permalink to this headline">¶</a></h3>
<p>Returns updated, filtered set of response headers to return to clients receiving the cached response. This function is necessary, because proxies MUST always remove hop-by-hop headers (such as <code class="docutils literal notranslate"><span class="pre">TE</span></code> and <code class="docutils literal notranslate"><span class="pre">Connection</span></code>) and update response’s <code class="docutils literal notranslate"><span class="pre">Age</span></code> to avoid doubling cache time.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">cachedResponse</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">cachePolicy</span><span class="p">.</span><span class="nx">responseHeaders</span><span class="p">(</span><span class="nx">cachedResponse</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="timetolive">
<h3><code class="docutils literal notranslate"><span class="pre">timeToLive()</span></code><a class="headerlink" href="#timetolive" title="Permalink to this headline">¶</a></h3>
<p>Returns approximate time in <em>milliseconds</em> until the response becomes stale (i.e. not fresh).</p>
<p>After that time (when <code class="docutils literal notranslate"><span class="pre">timeToLive()</span> <span class="pre">&lt;=</span> <span class="pre">0</span></code>) the response might not be usable without revalidation. However, there are exceptions, e.g. a client can explicitly allow stale responses, so always check with <code class="docutils literal notranslate"><span class="pre">satisfiesWithoutRevalidation()</span></code>.
<code class="docutils literal notranslate"><span class="pre">stale-if-error</span></code> and <code class="docutils literal notranslate"><span class="pre">stale-while-revalidate</span></code> extend the time to live of the cache, that can still be used if stale.</p>
</div>
<div class="section" id="toobject-fromobject-json">
<h3><code class="docutils literal notranslate"><span class="pre">toObject()</span></code>/<code class="docutils literal notranslate"><span class="pre">fromObject(json)</span></code><a class="headerlink" href="#toobject-fromobject-json" title="Permalink to this headline">¶</a></h3>
<p>Chances are you’ll want to store the <code class="docutils literal notranslate"><span class="pre">CachePolicy</span></code> object along with the cached response. <code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">policy.toObject()</span></code> gives a plain JSON-serializable object. <code class="docutils literal notranslate"><span class="pre">policy</span> <span class="pre">=</span> <span class="pre">CachePolicy.fromObject(obj)</span></code> creates an instance from it.</p>
</div>
<div class="section" id="refreshing-stale-cache-revalidation">
<h3>Refreshing stale cache (revalidation)<a class="headerlink" href="#refreshing-stale-cache-revalidation" title="Permalink to this headline">¶</a></h3>
<p>When a cached response has expired, it can be made fresh again by making a request to the origin server. The server may respond with status 304 (Not Modified) without sending the response body again, saving bandwidth.</p>
<p>The following methods help perform the update efficiently and correctly.</p>
<div class="section" id="revalidationheaders-newrequest">
<h4><code class="docutils literal notranslate"><span class="pre">revalidationHeaders(newRequest)</span></code><a class="headerlink" href="#revalidationheaders-newrequest" title="Permalink to this headline">¶</a></h4>
<p>Returns updated, filtered set of request headers to send to the origin server to check if the cached response can be reused. These headers allow the origin server to return status 304 indicating the response is still fresh. All headers unrelated to caching are passed through as-is.</p>
<p>Use this method when updating cache from the origin server.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">updateRequest</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">cachePolicy</span><span class="p">.</span><span class="nx">revalidationHeaders</span><span class="p">(</span><span class="nx">updateRequest</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="revalidatedpolicy-revalidationrequest-revalidationresponse">
<h4><code class="docutils literal notranslate"><span class="pre">revalidatedPolicy(revalidationRequest,</span> <span class="pre">revalidationResponse)</span></code><a class="headerlink" href="#revalidatedpolicy-revalidationrequest-revalidationresponse" title="Permalink to this headline">¶</a></h4>
<p>Use this method to update the cache after receiving a new response from the origin server. It returns an object with two keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">policy</span></code> — A new <code class="docutils literal notranslate"><span class="pre">CachePolicy</span></code> with HTTP headers updated from <code class="docutils literal notranslate"><span class="pre">revalidationResponse</span></code>. You can always replace the old cached <code class="docutils literal notranslate"><span class="pre">CachePolicy</span></code> with the new one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modified</span></code> — Boolean indicating whether the response body has changed.</p>
<ul>
<li><p>If <code class="docutils literal notranslate"><span class="pre">false</span></code>, then a valid 304 Not Modified response has been received, and you can reuse the old cached response body. This is also affected by <code class="docutils literal notranslate"><span class="pre">stale-if-error</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">true</span></code>, you should use new response’s body (if present), or make another request to the origin server without any conditional headers (i.e. don’t use <code class="docutils literal notranslate"><span class="pre">revalidationHeaders()</span></code> this time) to get the new resource.</p></li>
</ul>
</li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// When serving requests from cache:</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">oldPolicy</span><span class="p">,</span> <span class="nx">oldResponse</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">letsPretendThisIsSomeCache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
    <span class="nx">newRequest</span><span class="p">.</span><span class="nx">url</span>
<span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">oldPolicy</span><span class="p">.</span><span class="nx">satisfiesWithoutRevalidation</span><span class="p">(</span><span class="nx">newRequest</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Change the request to ask the origin server if the cached response can be used</span>
    <span class="nx">newRequest</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">oldPolicy</span><span class="p">.</span><span class="nx">revalidationHeaders</span><span class="p">(</span><span class="nx">newRequest</span><span class="p">);</span>

    <span class="c1">// Send request to the origin server. The server may respond with status 304</span>
    <span class="kr">const</span> <span class="nx">newResponse</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">makeRequest</span><span class="p">(</span><span class="nx">newRequest</span><span class="p">);</span>

    <span class="c1">// Create updated policy and combined response from the old and new data</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">modified</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">oldPolicy</span><span class="p">.</span><span class="nx">revalidatedPolicy</span><span class="p">(</span>
        <span class="nx">newRequest</span><span class="p">,</span>
        <span class="nx">newResponse</span>
    <span class="p">);</span>
    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">modified</span> <span class="o">?</span> <span class="nx">newResponse</span> <span class="o">:</span> <span class="nx">oldResponse</span><span class="p">;</span>

    <span class="c1">// Update the cache with the newer/fresher response</span>
    <span class="nx">letsPretendThisIsSomeCache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
        <span class="nx">newRequest</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
        <span class="p">{</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">response</span> <span class="p">},</span>
        <span class="nx">policy</span><span class="p">.</span><span class="nx">timeToLive</span><span class="p">()</span>
    <span class="p">);</span>

    <span class="c1">// And proceed returning cached response as usual</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">headers</span> <span class="o">=</span> <span class="nx">policy</span><span class="p">.</span><span class="nx">responseHeaders</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="yo-fresh">
<h1>Yo, FRESH<a class="headerlink" href="#yo-fresh" title="Permalink to this headline">¶</a></h1>
<p><img alt="satisfiesWithoutRevalidation" src=".cache/yarn/v6/npm-http-cache-semantics-4.1.0-49e91c5cbf36c9b94bcfcd71c23d5249ec74e390-integrity/node_modules/http-cache-semantics/fresh.jpg" /></p>
<div class="section" id="used-by">
<h2>Used by<a class="headerlink" href="#used-by" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://imageoptim.com/api">ImageOptim API</a>, <a class="reference external" href="https://github.com/zkat/make-fetch-happen">make-fetch-happen</a>, <a class="reference external" href="https://www.npmjs.com/package/cacheable-request">cacheable-request</a> (<a class="reference external" href="https://www.npmjs.com/package/got">got</a>), <a class="reference external" href="https://github.com/npm/registry-fetch">npm/registry-fetch</a>, <a class="reference external" href="https://github.com/kornelski/http-cache-semantics/network/dependents">etc.</a></p></li>
</ul>
</div>
<div class="section" id="implemented">
<h2>Implemented<a class="headerlink" href="#implemented" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> response header with all the quirks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Expires</span></code> with check for bad clocks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pragma</span></code> response header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Age</span></code> response header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Vary</span></code> response header.</p></li>
<li><p>Default cacheability of statuses and methods.</p></li>
<li><p>Requests for stale data.</p></li>
<li><p>Filtering of hop-by-hop headers.</p></li>
<li><p>Basic revalidation request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stale-if-error</span></code></p></li>
</ul>
</div>
<div class="section" id="unimplemented">
<h2>Unimplemented<a class="headerlink" href="#unimplemented" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Merging of range requests, <code class="docutils literal notranslate"><span class="pre">If-Range</span></code> (but correctly supports them as non-cacheable)</p></li>
<li><p>Revalidation of multiple representations</p></li>
</ul>
<div class="section" id="trusting-server-date">
<h3>Trusting server <code class="docutils literal notranslate"><span class="pre">Date</span></code><a class="headerlink" href="#trusting-server-date" title="Permalink to this headline">¶</a></h3>
<p>Per the RFC, the cache should take into account the time between server-supplied <code class="docutils literal notranslate"><span class="pre">Date</span></code> and the time it received the response. The RFC-mandated behavior creates two problems:</p>
<ul class="simple">
<li><p>Servers with incorrectly set timezone may add several hours to cache age (or more, if the clock is completely wrong).</p></li>
<li><p>Even reasonably correct clocks may be off by a couple of seconds, breaking <code class="docutils literal notranslate"><span class="pre">max-age=1</span></code> trick (which is useful for reverse proxies on high-traffic servers).</p></li>
</ul>
<p>Previous versions of this library had an option to ignore the server date if it was “too inaccurate”. To support the <code class="docutils literal notranslate"><span class="pre">max-age=1</span></code> trick the library also has to ignore dates that pretty accurate. There’s no point of having an option to trust dates that are only a bit inaccurate, so this library won’t trust any server dates. <code class="docutils literal notranslate"><span class="pre">max-age</span></code> will be interpreted from the time the response has been received, not from when it has been sent. This will affect only <a class="reference external" href="https://tools.ietf.org/html/rfc1149">RFC 1149 networks</a>.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AyrtonB/ESDA-Spatial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./.cache/yarn/v6/npm-http-cache-semantics-4.1.0-49e91c5cbf36c9b94bcfcd71c23d5249ec74e390-integrity/node_modules/http-cache-semantics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ayrton Bourn, Santiago De La Fuente, Clem Attwood, Joanna Kuleszo, Camilo Perico<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>