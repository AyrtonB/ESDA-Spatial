
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>jest-worker &#8212; Spatial Analysis for Energy</title>
    
  <link rel="stylesheet" href="../../../../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/language_data.js"></script>
    <script src="../../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../../../../index.html">
  
  <img src="../../../../../../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Spatial Analysis for Energy</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Intro.html">
   UCL Energy Systems &amp; Data Analytics - Spatial Module
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/03-Working-with-Vector-Data.html">
   Working with Vector Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/04-Working-with-Raster-Data.html">
   Working with Raster Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extensions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../extensions/01-Mapping-with-ggplot.html">
   Mapping with ggplot
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Setup.html">
   Set-Up Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Jupyter-Anaconda.html">
   What is Jupyter/Anaconda?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/ESDA%20Course.html">
   ESDA Course
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../../../_sources/.cache/yarn/v6/npm-jest-worker-25.5.0-2611d071b79cea0f43ee57a3d118593ac1547db1-integrity/node_modules/jest-worker/README.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   jest-worker
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#install">
     Install
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#file-parent-js">
       File
       <code class="docutils literal notranslate">
        <span class="pre">
         parent.js
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#file-worker-js">
       File
       <code class="docutils literal notranslate">
        <span class="pre">
         worker.js
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#experimental-worker">
     Experimental worker
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api">
     API
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#workerpath-string-required">
       <code class="docutils literal notranslate">
        <span class="pre">
         workerPath:
        </span>
        <span class="pre">
         string
        </span>
       </code>
       (required)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#options-object-optional">
       <code class="docutils literal notranslate">
        <span class="pre">
         options:
        </span>
        <span class="pre">
         Object
        </span>
       </code>
       (optional)
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#exposedmethods-readonlyarray-string-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           exposedMethods:
          </span>
          <span class="pre">
           $ReadOnlyArray&lt;string&gt;
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#numworkers-number-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           numWorkers:
          </span>
          <span class="pre">
           number
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#maxretries-number-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           maxRetries:
          </span>
          <span class="pre">
           number
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#forkoptions-object-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           forkOptions:
          </span>
          <span class="pre">
           Object
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#computeworkerkey-method-string-args-array-any-string-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           computeWorkerKey:
          </span>
          <span class="pre">
           (method:
          </span>
          <span class="pre">
           string,
          </span>
          <span class="pre">
           ...args:
          </span>
          <span class="pre">
           Array&lt;any&gt;)
          </span>
          <span class="pre">
           =&gt;
          </span>
          <span class="pre">
           ?string
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#setupargs-array-mixed-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           setupArgs:
          </span>
          <span class="pre">
           Array&lt;mixed&gt;
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#workerpool-workerpath-string-options-workerpooloptions-workerpoolinterface-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           WorkerPool:
          </span>
          <span class="pre">
           (workerPath:
          </span>
          <span class="pre">
           string,
          </span>
          <span class="pre">
           options?:
          </span>
          <span class="pre">
           WorkerPoolOptions)
          </span>
          <span class="pre">
           =&gt;
          </span>
          <span class="pre">
           WorkerPoolInterface
          </span>
         </code>
         (optional)
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#enableworkerthreads-boolean-optional">
         <code class="docutils literal notranslate">
          <span class="pre">
           enableWorkerThreads:
          </span>
          <span class="pre">
           boolean
          </span>
         </code>
         (optional)
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jestworker">
     JestWorker
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#methods">
       Methods
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#getstdout-readable">
         <code class="docutils literal notranslate">
          <span class="pre">
           getStdout():
          </span>
          <span class="pre">
           Readable
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#getstderr-readable">
         <code class="docutils literal notranslate">
          <span class="pre">
           getStderr():
          </span>
          <span class="pre">
           Readable
          </span>
         </code>
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#end">
         <code class="docutils literal notranslate">
          <span class="pre">
           end()
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#worker-ids">
       Worker IDs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-and-tearing-down-the-child-process">
     Setting up and tearing down the child process
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-examples">
   More examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standard-usage">
     Standard usage
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       File
       <code class="docutils literal notranslate">
        <span class="pre">
         parent.js
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       File
       <code class="docutils literal notranslate">
        <span class="pre">
         worker.js
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bound-worker-usage">
     Bound worker usage:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       File
       <code class="docutils literal notranslate">
        <span class="pre">
         parent.js
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       File
       <code class="docutils literal notranslate">
        <span class="pre">
         worker.js
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="jest-worker">
<h1>jest-worker<a class="headerlink" href="#jest-worker" title="Permalink to this headline">¶</a></h1>
<p>Module for executing heavy tasks under forked processes in parallel, by providing a <code class="docutils literal notranslate"><span class="pre">Promise</span></code> based interface, minimum overhead, and bound workers.</p>
<p>The module works by providing an absolute path of the module to be loaded in all forked processes. Files relative to a node module are also accepted. All methods are exposed on the parent process as promises, so they can be <code class="docutils literal notranslate"><span class="pre">await</span></code>’ed. Child (worker) methods can either be synchronous or asynchronous.</p>
<p>The module also implements support for bound workers. Binding a worker means that, based on certain parameters, the same task will always be executed by the same worker. The way bound workers work is by using the returned string of the <code class="docutils literal notranslate"><span class="pre">computeWorkerKey</span></code> method. If the string was used before for a task, the call will be queued to the related worker that processed the task earlier; if not, it will be executed by the first available worker, then sticked to the worker that executed it; so the next time it will be processed by the same worker. If you have no preference on the worker executing the task, but you have defined a <code class="docutils literal notranslate"><span class="pre">computeWorkerKey</span></code> method because you want <em>some</em> of the tasks to be sticked, you can return <code class="docutils literal notranslate"><span class="pre">null</span></code> from it.</p>
<p>The list of exposed methods can be explicitly provided via the <code class="docutils literal notranslate"><span class="pre">exposedMethods</span></code> option. If it is not provided, it will be obtained by requiring the child module into the main process, and analyzed via reflection. Check the “minimal example” section for a valid one.</p>
<div class="section" id="install">
<h2>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ yarn add jest-worker
</pre></div>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>This example covers the minimal usage:</p>
<div class="section" id="file-parent-js">
<h3>File <code class="docutils literal notranslate"><span class="pre">parent.js</span></code><a class="headerlink" href="#file-parent-js" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">JestWorker</span> <span class="nx">from</span> <span class="s1">&#39;jest-worker&#39;</span><span class="p">;</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">worker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JestWorker</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;./Worker&#39;</span><span class="p">));</span>
  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">worker</span><span class="p">.</span><span class="nx">hello</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">);</span> <span class="c1">// &quot;Hello, Alice&quot;</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="file-worker-js">
<h3>File <code class="docutils literal notranslate"><span class="pre">worker.js</span></code><a class="headerlink" href="#file-worker-js" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">hello</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="nx">param</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="experimental-worker">
<h2>Experimental worker<a class="headerlink" href="#experimental-worker" title="Permalink to this headline">¶</a></h2>
<p>Node 10 shipped with <a class="reference external" href="https://nodejs.org/api/worker_threads.html">worker-threads</a>, a “threading API” that uses SharedArrayBuffers to communicate between the main process and its child threads. This experimental Node feature can significantly improve the communication time between parent and child processes in <code class="docutils literal notranslate"><span class="pre">jest-worker</span></code>.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">worker_threads</span></code> are considered experimental in Node, you have to opt-in to this behavior by passing <code class="docutils literal notranslate"><span class="pre">enableWorkerThreads:</span> <span class="pre">true</span></code> when instantiating the worker. While the feature was unflagged in Node 11.7.0, you’ll need to run the Node process with the <code class="docutils literal notranslate"><span class="pre">--experimental-worker</span></code> flag for Node 10.</p>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>The only exposed method is a constructor (<code class="docutils literal notranslate"><span class="pre">JestWorker</span></code>) that is initialized by passing the worker path, plus an options object.</p>
<div class="section" id="workerpath-string-required">
<h3><code class="docutils literal notranslate"><span class="pre">workerPath:</span> <span class="pre">string</span></code> (required)<a class="headerlink" href="#workerpath-string-required" title="Permalink to this headline">¶</a></h3>
<p>Node module name or absolute path of the file to be loaded in the child processes. Use <code class="docutils literal notranslate"><span class="pre">require.resolve</span></code> to transform a relative path into an absolute one.</p>
</div>
<div class="section" id="options-object-optional">
<h3><code class="docutils literal notranslate"><span class="pre">options:</span> <span class="pre">Object</span></code> (optional)<a class="headerlink" href="#options-object-optional" title="Permalink to this headline">¶</a></h3>
<div class="section" id="exposedmethods-readonlyarray-string-optional">
<h4><code class="docutils literal notranslate"><span class="pre">exposedMethods:</span> <span class="pre">$ReadOnlyArray&lt;string&gt;</span></code> (optional)<a class="headerlink" href="#exposedmethods-readonlyarray-string-optional" title="Permalink to this headline">¶</a></h4>
<p>List of method names that can be called on the child processes from the parent process. You cannot expose any method named like a public <code class="docutils literal notranslate"><span class="pre">Worker</span></code> method, or starting with <code class="docutils literal notranslate"><span class="pre">_</span></code>. If you use method auto-discovery, then these methods will not be exposed, even if they exist.</p>
</div>
<div class="section" id="numworkers-number-optional">
<h4><code class="docutils literal notranslate"><span class="pre">numWorkers:</span> <span class="pre">number</span></code> (optional)<a class="headerlink" href="#numworkers-number-optional" title="Permalink to this headline">¶</a></h4>
<p>Amount of workers to spawn. Defaults to the number of CPUs minus 1.</p>
</div>
<div class="section" id="maxretries-number-optional">
<h4><code class="docutils literal notranslate"><span class="pre">maxRetries:</span> <span class="pre">number</span></code> (optional)<a class="headerlink" href="#maxretries-number-optional" title="Permalink to this headline">¶</a></h4>
<p>Maximum amount of times that a dead child can be re-spawned, per call. Defaults to <code class="docutils literal notranslate"><span class="pre">3</span></code>, pass <code class="docutils literal notranslate"><span class="pre">Infinity</span></code> to allow endless retries.</p>
</div>
<div class="section" id="forkoptions-object-optional">
<h4><code class="docutils literal notranslate"><span class="pre">forkOptions:</span> <span class="pre">Object</span></code> (optional)<a class="headerlink" href="#forkoptions-object-optional" title="Permalink to this headline">¶</a></h4>
<p>Allow customizing all options passed to <code class="docutils literal notranslate"><span class="pre">childProcess.fork</span></code>. By default, some values are set (<code class="docutils literal notranslate"><span class="pre">cwd</span></code>, <code class="docutils literal notranslate"><span class="pre">env</span></code> and <code class="docutils literal notranslate"><span class="pre">execArgv</span></code>), but you can override them and customize the rest. For a list of valid values, check <a class="reference external" href="https://nodejs.org/api/child_process.html#child_process_child_process_fork_modulepath_args_options">the Node documentation</a>.</p>
</div>
<div class="section" id="computeworkerkey-method-string-args-array-any-string-optional">
<h4><code class="docutils literal notranslate"><span class="pre">computeWorkerKey:</span> <span class="pre">(method:</span> <span class="pre">string,</span> <span class="pre">...args:</span> <span class="pre">Array&lt;any&gt;)</span> <span class="pre">=&gt;</span> <span class="pre">?string</span></code> (optional)<a class="headerlink" href="#computeworkerkey-method-string-args-array-any-string-optional" title="Permalink to this headline">¶</a></h4>
<p>Every time a method exposed via the API is called, <code class="docutils literal notranslate"><span class="pre">computeWorkerKey</span></code> is also called in order to bound the call to a worker. This is useful for workers that are able to cache the result or part of it. You bound calls to a worker by making <code class="docutils literal notranslate"><span class="pre">computeWorkerKey</span></code> return the same identifier for all different calls. If you do not want to bind the call to any worker, return <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>The callback you provide is called with the method name, plus all the rest of the arguments of the call. Thus, you have full control to decide what to return. Check a practical example on bound workers under the “bound worker usage” section.</p>
<p>By default, no process is bound to any worker.</p>
</div>
<div class="section" id="setupargs-array-mixed-optional">
<h4><code class="docutils literal notranslate"><span class="pre">setupArgs:</span> <span class="pre">Array&lt;mixed&gt;</span></code> (optional)<a class="headerlink" href="#setupargs-array-mixed-optional" title="Permalink to this headline">¶</a></h4>
<p>The arguments that will be passed to the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method during initialization.</p>
</div>
<div class="section" id="workerpool-workerpath-string-options-workerpooloptions-workerpoolinterface-optional">
<h4><code class="docutils literal notranslate"><span class="pre">WorkerPool:</span> <span class="pre">(workerPath:</span> <span class="pre">string,</span> <span class="pre">options?:</span> <span class="pre">WorkerPoolOptions)</span> <span class="pre">=&gt;</span> <span class="pre">WorkerPoolInterface</span></code> (optional)<a class="headerlink" href="#workerpool-workerpath-string-options-workerpooloptions-workerpoolinterface-optional" title="Permalink to this headline">¶</a></h4>
<p>Provide a custom worker pool to be used for spawning child processes. By default, Jest will use a node thread pool if available and fall back to child process threads.</p>
<p>The arguments that will be passed to the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method during initialization.</p>
</div>
<div class="section" id="enableworkerthreads-boolean-optional">
<h4><code class="docutils literal notranslate"><span class="pre">enableWorkerThreads:</span> <span class="pre">boolean</span></code> (optional)<a class="headerlink" href="#enableworkerthreads-boolean-optional" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">jest-worker</span></code> will automatically detect if <code class="docutils literal notranslate"><span class="pre">worker_threads</span></code> are available, but will not use them unless passed <code class="docutils literal notranslate"><span class="pre">enableWorkerThreads:</span> <span class="pre">true</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="jestworker">
<h2>JestWorker<a class="headerlink" href="#jestworker" title="Permalink to this headline">¶</a></h2>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<p>The returned <code class="docutils literal notranslate"><span class="pre">JestWorker</span></code> instance has all the exposed methods, plus some additional ones to interact with the workers itself:</p>
<div class="section" id="getstdout-readable">
<h4><code class="docutils literal notranslate"><span class="pre">getStdout():</span> <span class="pre">Readable</span></code><a class="headerlink" href="#getstdout-readable" title="Permalink to this headline">¶</a></h4>
<p>Returns a <code class="docutils literal notranslate"><span class="pre">ReadableStream</span></code> where the standard output of all workers is piped. Note that the <code class="docutils literal notranslate"><span class="pre">silent</span></code> option of the child workers must be set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to make it work. This is the default set by <code class="docutils literal notranslate"><span class="pre">jest-worker</span></code>, but keep it in mind when overriding options through <code class="docutils literal notranslate"><span class="pre">forkOptions</span></code>.</p>
</div>
<div class="section" id="getstderr-readable">
<h4><code class="docutils literal notranslate"><span class="pre">getStderr():</span> <span class="pre">Readable</span></code><a class="headerlink" href="#getstderr-readable" title="Permalink to this headline">¶</a></h4>
<p>Returns a <code class="docutils literal notranslate"><span class="pre">ReadableStream</span></code> where the standard error of all workers is piped. Note that the <code class="docutils literal notranslate"><span class="pre">silent</span></code> option of the child workers must be set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to make it work. This is the default set by <code class="docutils literal notranslate"><span class="pre">jest-worker</span></code>, but keep it in mind when overriding options through <code class="docutils literal notranslate"><span class="pre">forkOptions</span></code>.</p>
</div>
<div class="section" id="end">
<h4><code class="docutils literal notranslate"><span class="pre">end()</span></code><a class="headerlink" href="#end" title="Permalink to this headline">¶</a></h4>
<p>Finishes the workers by killing all workers. No further calls can be done to the <code class="docutils literal notranslate"><span class="pre">Worker</span></code> instance.</p>
<p>Returns a Promise that resolves with <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">forceExited:</span> <span class="pre">boolean</span> <span class="pre">}</span></code> once all workers are dead. If <code class="docutils literal notranslate"><span class="pre">forceExited</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, at least one of the workers did not exit gracefully, which likely happened because it executed a leaky task that left handles open. This should be avoided, force exiting workers is a last resort to prevent creating lots of orphans.</p>
<p><strong>Note:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">await</span></code>ing the <code class="docutils literal notranslate"><span class="pre">end()</span></code> Promise immediately after the workers are no longer needed before proceeding to do other useful things in your program may not be a good idea. If workers have to be force exited, <code class="docutils literal notranslate"><span class="pre">jest-worker</span></code> may go through multiple stages of force exiting (e.g. SIGTERM, later SIGKILL) and give the worker overall around 1 second time to exit on its own. During this time, your program will wait, even though it may not be necessary that all workers are dead before continuing execution.</p>
<p>Consider deliberately leaving this Promise floating (unhandled resolution). After your program has done the rest of its work and is about to exit, the Node process will wait for the Promise to resolve after all workers are dead as the last event loop task. That way you parallelized computation time of your program and waiting time and you didn’t delay the outputs of your program unnecessarily.</p>
</div>
</div>
<div class="section" id="worker-ids">
<h3>Worker IDs<a class="headerlink" href="#worker-ids" title="Permalink to this headline">¶</a></h3>
<p>Each worker has a unique id (index that starts with <code class="docutils literal notranslate"><span class="pre">1</span></code>), which is available inside the worker as <code class="docutils literal notranslate"><span class="pre">process.env.JEST_WORKER_ID</span></code>.</p>
</div>
</div>
<div class="section" id="setting-up-and-tearing-down-the-child-process">
<h2>Setting up and tearing down the child process<a class="headerlink" href="#setting-up-and-tearing-down-the-child-process" title="Permalink to this headline">¶</a></h2>
<p>The child process can define two special methods (both of them can be asynchronous):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">setup()</span></code>: If defined, it’s executed before the first call to any method in the child.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">teardown()</span></code>: If defined, it’s executed when the farm ends.</p></li>
</ul>
</div>
</div>
<div class="section" id="more-examples">
<h1>More examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="standard-usage">
<h2>Standard usage<a class="headerlink" href="#standard-usage" title="Permalink to this headline">¶</a></h2>
<p>This example covers the standard usage:</p>
<div class="section" id="id1">
<h3>File <code class="docutils literal notranslate"><span class="pre">parent.js</span></code><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">JestWorker</span> <span class="nx">from</span> <span class="s1">&#39;jest-worker&#39;</span><span class="p">;</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JestWorker</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;./Worker&#39;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">exposedMethods</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;getWorkerId&#39;</span><span class="p">],</span>
    <span class="nx">numWorkers</span><span class="o">:</span> <span class="mf">4</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">foo</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">));</span> <span class="c1">// &quot;Hello from foo: Alice&quot;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">bar</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">));</span> <span class="c1">// &quot;Hello from bar: Bob&quot;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">getWorkerId</span><span class="p">());</span> <span class="c1">// &quot;3&quot; -&gt; this message has sent from the 3rd worker</span>

  <span class="kr">const</span> <span class="p">{</span><span class="nx">forceExited</span><span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">forceExited</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Workers failed to exit gracefully&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>File <code class="docutils literal notranslate"><span class="pre">worker.js</span></code><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">&#39;Hello from foo: &#39;</span> <span class="o">+</span> <span class="nx">param</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">bar</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s1">&#39;Hello from bar: &#39;</span> <span class="o">+</span> <span class="nx">param</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">getWorkerId</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JEST_WORKER_ID</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bound-worker-usage">
<h2>Bound worker usage:<a class="headerlink" href="#bound-worker-usage" title="Permalink to this headline">¶</a></h2>
<p>This example covers the usage with a <code class="docutils literal notranslate"><span class="pre">computeWorkerKey</span></code> method:</p>
<div class="section" id="id3">
<h3>File <code class="docutils literal notranslate"><span class="pre">parent.js</span></code><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">JestWorker</span> <span class="nx">from</span> <span class="s1">&#39;jest-worker&#39;</span><span class="p">;</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JestWorker</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;./Worker&#39;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">computeWorkerKey</span><span class="o">:</span> <span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">filename</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="c1">// Transform the given file, within the first available worker.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="s1">&#39;/tmp/foo.js&#39;</span><span class="p">));</span>

  <span class="c1">// Wait a bit.</span>
  <span class="nx">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mf">10000</span><span class="p">);</span>

  <span class="c1">// Transform the same file again. Will immediately return because the</span>
  <span class="c1">// transformed file is cached in the worker, and `computeWorkerKey` ensures</span>
  <span class="c1">// the same worker that processed the file the first time will process it now.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="s1">&#39;/tmp/foo.js&#39;</span><span class="p">));</span>

  <span class="kr">const</span> <span class="p">{</span><span class="nx">forceExited</span><span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">myWorker</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">forceExited</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Workers failed to exit gracefully&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>File <code class="docutils literal notranslate"><span class="pre">worker.js</span></code><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">babel</span> <span class="nx">from</span> <span class="s1">&#39;@babel/core&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">filename</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">filename</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="c1">// jest-worker can handle both immediate results and thenables. If a</span>
  <span class="c1">// thenable is returned, it will be await&#39;ed until it resolves.</span>
  <span class="k">return</span> <span class="nx">babel</span><span class="p">.</span><span class="nx">transformFileAsync</span><span class="p">(</span><span class="nx">filename</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">cache</span><span class="p">[</span><span class="nx">filename</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AyrtonB/ESDA-Spatial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./.cache/yarn/v6/npm-jest-worker-25.5.0-2611d071b79cea0f43ee57a3d118593ac1547db1-integrity/node_modules/jest-worker"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ayrton Bourn, Santiago De La Fuente, Clem Attwood, Joanna Kuleszo, Camilo Perico<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>