
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>minipass &#8212; Spatial Analysis for Energy</title>
    
  <link rel="stylesheet" href="../../../../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../../_static/jquery.js"></script>
    <script src="../../../../../../_static/underscore.js"></script>
    <script src="../../../../../../_static/doctools.js"></script>
    <script src="../../../../../../_static/language_data.js"></script>
    <script src="../../../../../../_static/togglebutton.js"></script>
    <script src="../../../../../../_static/clipboard.min.js"></script>
    <script src="../../../../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../../../../index.html">
  
  <img src="../../../../../../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Spatial Analysis for Energy</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Intro.html">
   UCL Energy Systems &amp; Data Analytics - Spatial Module
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/03-Working-with-Vector-Data.html">
   Working with Vector Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../tutorials/04-Working-with-Raster-Data.html">
   Working with Raster Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Extensions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../extensions/01-Mapping-with-ggplot.html">
   Mapping with ggplot
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Setup.html">
   Set-Up Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/Jupyter-Anaconda.html">
   What is Jupyter/Anaconda?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../../../md/ESDA%20Course.html">
   ESDA Course
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../../../../_sources/.cache/yarn/v6/npm-minipass-3.1.3-7d42ff1f39635482e15f9cdb53184deebd5815fd-integrity/node_modules/minipass/README.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differences-from-node-js-streams">
   Differences from Node.js Streams
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#timing">
     Timing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#no-high-low-water-marks">
     No High/Low Water Marks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hazards-of-buffering-or-why-minipass-is-so-fast">
     Hazards of Buffering (or: Why Minipass Is So Fast)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#immediately-emit-end-for-empty-streams-when-not-paused">
     Immediately emit
     <code class="docutils literal notranslate">
      <span class="pre">
       end
      </span>
     </code>
     for empty streams (when not paused)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#emit-end-when-asked">
     Emit
     <code class="docutils literal notranslate">
      <span class="pre">
       end
      </span>
     </code>
     When Asked
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#impact-of-immediate-flow-on-tee-streams">
     Impact of “immediate flow” on Tee-streams
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage">
   USAGE
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options">
     OPTIONS
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#api">
     API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#methods">
     Methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#properties">
     Properties
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#events">
     Events
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#static-methods">
     Static Methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   EXAMPLES
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-are-you-done-yet-promise">
     simple “are you done yet” promise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collecting">
     collecting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collecting-into-a-single-blob">
     collecting into a single blob
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iteration">
     iteration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#subclass-that-console-log-s-everything-written-into-it">
     subclass that
     <code class="docutils literal notranslate">
      <span class="pre">
       console.log()
      </span>
     </code>
     s everything written into it
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#same-thing-but-using-an-inline-anonymous-class">
     same thing, but using an inline anonymous class
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#subclass-that-defers-end-for-some-reason">
     subclass that defers ‘end’ for some reason
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transform-that-creates-newline-delimited-json">
     transform that creates newline-delimited JSON
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transform-that-parses-newline-delimited-json">
     transform that parses newline-delimited JSON
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="minipass">
<h1>minipass<a class="headerlink" href="#minipass" title="Permalink to this headline">¶</a></h1>
<p>A <em>very</em> minimal implementation of a <a class="reference external" href="https://nodejs.org/api/stream.html#stream_class_stream_passthrough">PassThrough
stream</a></p>
<p><a class="reference external" href="https://docs.google.com/spreadsheets/d/1oObKSrVwLX_7Ut4Z6g3fZW-AX1j1-k6w-cDsrkaSbHM/edit#gid=0">It’s very
fast</a>
for objects, strings, and buffers.</p>
<p>Supports pipe()ing (including multi-pipe() and backpressure transmission),
buffering data until either a <code class="docutils literal notranslate"><span class="pre">data</span></code> event handler or <code class="docutils literal notranslate"><span class="pre">pipe()</span></code> is added (so
you don’t lose the first chunk), and most other cases where PassThrough is
a good idea.</p>
<p>There is a <code class="docutils literal notranslate"><span class="pre">read()</span></code> method, but it’s much more efficient to consume data
from this stream via <code class="docutils literal notranslate"><span class="pre">'data'</span></code> events or by calling <code class="docutils literal notranslate"><span class="pre">pipe()</span></code> into some other
stream.  Calling <code class="docutils literal notranslate"><span class="pre">read()</span></code> requires the buffer to be flattened in some
cases, which requires copying memory.</p>
<p>There is also no <code class="docutils literal notranslate"><span class="pre">unpipe()</span></code> method.  Once you start piping, there is no
stopping it!</p>
<p>If you set <code class="docutils literal notranslate"><span class="pre">objectMode:</span> <span class="pre">true</span></code> in the options, then whatever is written will
be emitted.  Otherwise, it’ll do a minimal amount of Buffer copying to
ensure proper Streams semantics when <code class="docutils literal notranslate"><span class="pre">read(n)</span></code> is called.</p>
<p><code class="docutils literal notranslate"><span class="pre">objectMode</span></code> can also be set by doing <code class="docutils literal notranslate"><span class="pre">stream.objectMode</span> <span class="pre">=</span> <span class="pre">true</span></code>, or by
writing any non-string/non-buffer data.  <code class="docutils literal notranslate"><span class="pre">objectMode</span></code> cannot be set to
false once it is set.</p>
<p>This is not a <code class="docutils literal notranslate"><span class="pre">through</span></code> or <code class="docutils literal notranslate"><span class="pre">through2</span></code> stream.  It doesn’t transform the
data, it just passes it right through.  If you want to transform the data,
extend the class, and override the <code class="docutils literal notranslate"><span class="pre">write()</span></code> method.  Once you’re done
transforming the data however you want, call <code class="docutils literal notranslate"><span class="pre">super.write()</span></code> with the
transform output.</p>
<p>For some examples of streams that extend Minipass in various ways, check
out:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://npm.im/minizlib">minizlib</a></p></li>
<li><p><a class="reference external" href="http://npm.im/fs-minipass">fs-minipass</a></p></li>
<li><p><a class="reference external" href="http://npm.im/tar">tar</a></p></li>
<li><p><a class="reference external" href="http://npm.im/minipass-collect">minipass-collect</a></p></li>
<li><p><a class="reference external" href="http://npm.im/minipass-flush">minipass-flush</a></p></li>
<li><p><a class="reference external" href="http://npm.im/minipass-pipeline">minipass-pipeline</a></p></li>
<li><p><a class="reference external" href="http://npm.im/tap">tap</a></p></li>
<li><p><a class="reference external" href="http://npm.im/tap">tap-parser</a></p></li>
<li><p><a class="reference external" href="http://npm.im/tap">treport</a></p></li>
<li><p><a class="reference external" href="http://npm.im/minipass-fetch">minipass-fetch</a></p></li>
<li><p><a class="reference external" href="http://npm.im/pacote">pacote</a></p></li>
<li><p><a class="reference external" href="http://npm.im/make-fetch-happen">make-fetch-happen</a></p></li>
<li><p><a class="reference external" href="http://npm.im/cacache">cacache</a></p></li>
<li><p><a class="reference external" href="http://npm.im/ssri">ssri</a></p></li>
<li><p><a class="reference external" href="http://npm.im/npm-registry-fetch">npm-registry-fetch</a></p></li>
<li><p><a class="reference external" href="http://npm.im/minipass-json-stream">minipass-json-stream</a></p></li>
<li><p><a class="reference external" href="http://npm.im/minipass-sized">minipass-sized</a></p></li>
</ul>
<div class="section" id="differences-from-node-js-streams">
<h2>Differences from Node.js Streams<a class="headerlink" href="#differences-from-node-js-streams" title="Permalink to this headline">¶</a></h2>
<p>There are several things that make Minipass streams different from (and in
some ways superior to) Node.js core streams.</p>
<p>Please read these caveats if you are familiar with noode-core streams and
intend to use Minipass streams in your programs.</p>
<div class="section" id="timing">
<h3>Timing<a class="headerlink" href="#timing" title="Permalink to this headline">¶</a></h3>
<p>Minipass streams are designed to support synchronous use-cases.  Thus, data
is emitted as soon as it is available, always.  It is buffered until read,
but no longer.  Another way to look at it is that Minipass streams are
exactly as synchronous as the logic that writes into them.</p>
<p>This can be surprising if your code relies on <code class="docutils literal notranslate"><span class="pre">PassThrough.write()</span></code> always
providing data on the next tick rather than the current one, or being able
to call <code class="docutils literal notranslate"><span class="pre">resume()</span></code> and not have the entire buffer disappear immediately.</p>
<p>However, without this synchronicity guarantee, there would be no way for
Minipass to achieve the speeds it does, or support the synchronous use
cases that it does.  Simply put, waiting takes time.</p>
<p>This non-deferring approach makes Minipass streams much easier to reason
about, especially in the context of Promises and other flow-control
mechanisms.</p>
</div>
<div class="section" id="no-high-low-water-marks">
<h3>No High/Low Water Marks<a class="headerlink" href="#no-high-low-water-marks" title="Permalink to this headline">¶</a></h3>
<p>Node.js core streams will optimistically fill up a buffer, returning <code class="docutils literal notranslate"><span class="pre">true</span></code>
on all writes until the limit is hit, even if the data has nowhere to go.
Then, they will not attempt to draw more data in until the buffer size dips
below a minimum value.</p>
<p>Minipass streams are much simpler.  The <code class="docutils literal notranslate"><span class="pre">write()</span></code> method will return <code class="docutils literal notranslate"><span class="pre">true</span></code>
if the data has somewhere to go (which is to say, given the timing
guarantees, that the data is already there by the time <code class="docutils literal notranslate"><span class="pre">write()</span></code> returns).</p>
<p>If the data has nowhere to go, then <code class="docutils literal notranslate"><span class="pre">write()</span></code> returns false, and the data
sits in a buffer, to be drained out immediately as soon as anyone consumes
it.</p>
</div>
<div class="section" id="hazards-of-buffering-or-why-minipass-is-so-fast">
<h3>Hazards of Buffering (or: Why Minipass Is So Fast)<a class="headerlink" href="#hazards-of-buffering-or-why-minipass-is-so-fast" title="Permalink to this headline">¶</a></h3>
<p>Since data written to a Minipass stream is immediately written all the way
through the pipeline, and <code class="docutils literal notranslate"><span class="pre">write()</span></code> always returns true/false based on
whether the data was fully flushed, backpressure is communicated
immediately to the upstream caller.  This minimizes buffering.</p>
<p>Consider this case:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="p">{</span><span class="nx">PassThrough</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;stream&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PassThrough</span><span class="p">({</span> <span class="nx">highWaterMark</span><span class="o">:</span> <span class="mf">1024</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PassThrough</span><span class="p">({</span> <span class="nx">highWaterMark</span><span class="o">:</span> <span class="mf">1024</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PassThrough</span><span class="p">({</span> <span class="nx">highWaterMark</span><span class="o">:</span> <span class="mf">1024</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">p4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PassThrough</span><span class="p">({</span> <span class="nx">highWaterMark</span><span class="o">:</span> <span class="mf">1024</span> <span class="p">})</span>

<span class="nx">p1</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">p2</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">p3</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">p4</span><span class="p">)</span>
<span class="nx">p4</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;made it through&#39;</span><span class="p">))</span>

<span class="c1">// this returns false and buffers, then writes to p2 on next tick (1)</span>
<span class="c1">// p2 returns false and buffers, pausing p1, then writes to p3 on next tick (2)</span>
<span class="c1">// p3 returns false and buffers, pausing p2, then writes to p4 on next tick (3)</span>
<span class="c1">// p4 returns false and buffers, pausing p3, then emits &#39;data&#39; and &#39;drain&#39;</span>
<span class="c1">// on next tick (4)</span>
<span class="c1">// p3 sees p4&#39;s &#39;drain&#39; event, and calls resume(), emitting &#39;resume&#39; and</span>
<span class="c1">// &#39;drain&#39; on next tick (5)</span>
<span class="c1">// p2 sees p3&#39;s &#39;drain&#39;, calls resume(), emits &#39;resume&#39; and &#39;drain&#39; on next tick (6)</span>
<span class="c1">// p1 sees p2&#39;s &#39;drain&#39;, calls resume(), emits &#39;resume&#39; and &#39;drain&#39; on next</span>
<span class="c1">// tick (7)</span>

<span class="nx">p1</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">alloc</span><span class="p">(</span><span class="mf">2048</span><span class="p">))</span> <span class="c1">// returns false</span>
</pre></div>
</div>
<p>Along the way, the data was buffered and deferred at each stage, and
multiple event deferrals happened, for an unblocked pipeline where it was
perfectly safe to write all the way through!</p>
<p>Furthermore, setting a <code class="docutils literal notranslate"><span class="pre">highWaterMark</span></code> of <code class="docutils literal notranslate"><span class="pre">1024</span></code> might lead someone reading
the code to think an advisory maximum of 1KiB is being set for the
pipeline.  However, the actual advisory buffering level is the <em>sum</em> of
<code class="docutils literal notranslate"><span class="pre">highWaterMark</span></code> values, since each one has its own bucket.</p>
<p>Consider the Minipass case:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">m1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">m2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">m3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">m4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>

<span class="nx">m1</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">m2</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">m3</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">m4</span><span class="p">)</span>
<span class="nx">m4</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;made it through&#39;</span><span class="p">))</span>

<span class="c1">// m1 is flowing, so it writes the data to m2 immediately</span>
<span class="c1">// m2 is flowing, so it writes the data to m3 immediately</span>
<span class="c1">// m3 is flowing, so it writes the data to m4 immediately</span>
<span class="c1">// m4 is flowing, so it fires the &#39;data&#39; event immediately, returns true</span>
<span class="c1">// m4&#39;s write returned true, so m3 is still flowing, returns true</span>
<span class="c1">// m3&#39;s write returned true, so m2 is still flowing, returns true</span>
<span class="c1">// m2&#39;s write returned true, so m1 is still flowing, returns true</span>
<span class="c1">// No event deferrals or buffering along the way!</span>

<span class="nx">m1</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">alloc</span><span class="p">(</span><span class="mf">2048</span><span class="p">))</span> <span class="c1">// returns true</span>
</pre></div>
</div>
<p>It is extremely unlikely that you <em>don’t</em> want to buffer any data written,
or <em>ever</em> buffer data that can be flushed all the way through.  Neither
node-core streams nor Minipass ever fail to buffer written data, but
node-core streams do a lot of unnecessary buffering and pausing.</p>
<p>As always, the faster implementation is the one that does less stuff and
waits less time to do it.</p>
</div>
<div class="section" id="immediately-emit-end-for-empty-streams-when-not-paused">
<h3>Immediately emit <code class="docutils literal notranslate"><span class="pre">end</span></code> for empty streams (when not paused)<a class="headerlink" href="#immediately-emit-end-for-empty-streams-when-not-paused" title="Permalink to this headline">¶</a></h3>
<p>If a stream is not paused, and <code class="docutils literal notranslate"><span class="pre">end()</span></code> is called before writing any data
into it, then it will emit <code class="docutils literal notranslate"><span class="pre">end</span></code> immediately.</p>
<p>If you have logic that occurs on the <code class="docutils literal notranslate"><span class="pre">end</span></code> event which you don’t want to
potentially happen immediately (for example, closing file descriptors,
moving on to the next entry in an archive parse stream, etc.) then be sure
to call <code class="docutils literal notranslate"><span class="pre">stream.pause()</span></code> on creation, and then <code class="docutils literal notranslate"><span class="pre">stream.resume()</span></code> once you
are ready to respond to the <code class="docutils literal notranslate"><span class="pre">end</span></code> event.</p>
</div>
<div class="section" id="emit-end-when-asked">
<h3>Emit <code class="docutils literal notranslate"><span class="pre">end</span></code> When Asked<a class="headerlink" href="#emit-end-when-asked" title="Permalink to this headline">¶</a></h3>
<p>One hazard of immediately emitting <code class="docutils literal notranslate"><span class="pre">'end'</span></code> is that you may not yet have had
a chance to add a listener.  In order to avoid this hazard, Minipass
streams safely re-emit the <code class="docutils literal notranslate"><span class="pre">'end'</span></code> event if a new listener is added after
<code class="docutils literal notranslate"><span class="pre">'end'</span></code> has been emitted.</p>
<p>Ie, if you do <code class="docutils literal notranslate"><span class="pre">stream.on('end',</span> <span class="pre">someFunction)</span></code>, and the stream has already
emitted <code class="docutils literal notranslate"><span class="pre">end</span></code>, then it will call the handler right away.  (You can think of
this somewhat like attaching a new <code class="docutils literal notranslate"><span class="pre">.then(fn)</span></code> to a previously-resolved
Promise.)</p>
<p>To prevent calling handlers multiple times who would not expect multiple
ends to occur, all listeners are removed from the <code class="docutils literal notranslate"><span class="pre">'end'</span></code> event whenever it
is emitted.</p>
</div>
<div class="section" id="impact-of-immediate-flow-on-tee-streams">
<h3>Impact of “immediate flow” on Tee-streams<a class="headerlink" href="#impact-of-immediate-flow-on-tee-streams" title="Permalink to this headline">¶</a></h3>
<p>A “tee stream” is a stream piping to multiple destinations:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">t</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">dest1</span><span class="p">)</span>
<span class="nx">t</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">dest2</span><span class="p">)</span>
<span class="nx">t</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1">// goes to both destinations</span>
</pre></div>
</div>
<p>Since Minipass streams <em>immediately</em> process any pending data through the
pipeline when a new pipe destination is added, this can have surprising
effects, especially when a stream comes in from some other function and may
or may not have data in its buffer.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// WARNING! WILL LOSE DATA!</span>
<span class="kr">const</span> <span class="nx">src</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">dest1</span><span class="p">)</span> <span class="c1">// &#39;foo&#39; chunk flows to dest1 immediately, and is gone</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">dest2</span><span class="p">)</span> <span class="c1">// gets nothing!</span>
</pre></div>
</div>
<p>The solution is to create a dedicated tee-stream junction that pipes to
both locations, and then pipe to <em>that</em> instead.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Safe example: tee to both places</span>
<span class="kr">const</span> <span class="nx">src</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">tee</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">dest1</span><span class="p">)</span>
<span class="nx">tee</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">dest2</span><span class="p">)</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">tee</span><span class="p">)</span> <span class="c1">// tee gets &#39;foo&#39;, pipes to both locations</span>
</pre></div>
</div>
<p>The same caveat applies to <code class="docutils literal notranslate"><span class="pre">on('data')</span></code> event listeners.  The first one
added will <em>immediately</em> receive all of the data, leaving nothing for the
second:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// WARNING! WILL LOSE DATA!</span>
<span class="kr">const</span> <span class="nx">src</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">handler1</span><span class="p">)</span> <span class="c1">// receives &#39;foo&#39; right away</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">handler2</span><span class="p">)</span> <span class="c1">// nothing to see here!</span>
</pre></div>
</div>
<p>Using a dedicated tee-stream can be used in this case as well:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Safe example: tee to both data handlers</span>
<span class="kr">const</span> <span class="nx">src</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">()</span>
<span class="nx">tee</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">handler1</span><span class="p">)</span>
<span class="nx">tee</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">handler2</span><span class="p">)</span>
<span class="nx">src</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">tee</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="usage">
<h2>USAGE<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>It’s a stream!  Use it like a stream and it’ll most likely do what you
want.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Minipass</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;minipass&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">mp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="c1">// optional: { encoding, objectMode }</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someOtherStream</span><span class="p">)</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="options">
<h3>OPTIONS<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code> How would you like the data coming <em>out</em> of the stream to be
encoded?  Accepts any values that can be passed to <code class="docutils literal notranslate"><span class="pre">Buffer.toString()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">objectMode</span></code> Emit data exactly as it comes in.  This will be flipped on
by default if you write() something other than a string or Buffer at any
point.  Setting <code class="docutils literal notranslate"><span class="pre">objectMode:</span> <span class="pre">true</span></code> will prevent setting any encoding
value.</p></li>
</ul>
</div>
<div class="section" id="api">
<h3>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h3>
<p>Implements the user-facing portions of Node.js’s <code class="docutils literal notranslate"><span class="pre">Readable</span></code> and <code class="docutils literal notranslate"><span class="pre">Writable</span></code>
streams.</p>
</div>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">write(chunk,</span> <span class="pre">[encoding],</span> <span class="pre">[callback])</span></code> - Put data in.  (Note that, in the
base Minipass class, the same data will come out.)  Returns <code class="docutils literal notranslate"><span class="pre">false</span></code> if
the stream will buffer the next write, or true if it’s still in “flowing”
mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end([chunk,</span> <span class="pre">[encoding]],</span> <span class="pre">[callback])</span></code> - Signal that you have no more
data to write.  This will queue an <code class="docutils literal notranslate"><span class="pre">end</span></code> event to be fired when all the
data has been consumed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setEncoding(encoding)</span></code> - Set the encoding for data coming of the stream.
This can only be done once.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pause()</span></code> - No more data for a while, please.  This also prevents <code class="docutils literal notranslate"><span class="pre">end</span></code>
from being emitted for empty streams until the stream is resumed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume()</span></code> - Resume the stream.  If there’s data in the buffer, it is all
discarded.  Any buffered events are immediately emitted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipe(dest)</span></code> - Send all output to the stream provided.  There is no way
to unpipe.  When data is emitted, it is immediately written to any and
all pipe destinations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on(ev,</span> <span class="pre">fn)</span></code>, <code class="docutils literal notranslate"><span class="pre">emit(ev,</span> <span class="pre">fn)</span></code> - Minipass streams are EventEmitters.  Some
events are given special treatment, however.  (See below under “events”.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">promise()</span></code> - Returns a Promise that resolves when the stream emits
<code class="docutils literal notranslate"><span class="pre">end</span></code>, or rejects if the stream emits <code class="docutils literal notranslate"><span class="pre">error</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collect()</span></code> - Return a Promise that resolves on <code class="docutils literal notranslate"><span class="pre">end</span></code> with an array
containing each chunk of data that was emitted, or rejects if the stream
emits <code class="docutils literal notranslate"><span class="pre">error</span></code>.  Note that this consumes the stream data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">concat()</span></code> - Same as <code class="docutils literal notranslate"><span class="pre">collect()</span></code>, but concatenates the data into a single
Buffer object.  Will reject the returned promise if the stream is in
objectMode, or if it goes into objectMode by the end of the data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read(n)</span></code> - Consume <code class="docutils literal notranslate"><span class="pre">n</span></code> bytes of data out of the buffer.  If <code class="docutils literal notranslate"><span class="pre">n</span></code> is not
provided, then consume all of it.  If <code class="docutils literal notranslate"><span class="pre">n</span></code> bytes are not available, then
it returns null.  <strong>Note</strong> consuming streams in this way is less
efficient, and can lead to unnecessary Buffer copying.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destroy([er])</span></code> - Destroy the stream.  If an error is provided, then an
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> event is emitted.  If the stream has a <code class="docutils literal notranslate"><span class="pre">close()</span></code> method, and
has not emitted a <code class="docutils literal notranslate"><span class="pre">'close'</span></code> event yet, then <code class="docutils literal notranslate"><span class="pre">stream.close()</span></code> will be
called.  Any Promises returned by <code class="docutils literal notranslate"><span class="pre">.promise()</span></code>, <code class="docutils literal notranslate"><span class="pre">.collect()</span></code> or
<code class="docutils literal notranslate"><span class="pre">.concat()</span></code> will be rejected.  After being destroyed, writing to the
stream will emit an error.  No more data will be emitted if the stream is
destroyed, even if it was previously buffered.</p></li>
</ul>
</div>
<div class="section" id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bufferLength</span></code> Read-only.  Total number of bytes buffered, or in the case
of objectMode, the total number of objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code> The encoding that has been set.  (Setting this is equivalent
to calling <code class="docutils literal notranslate"><span class="pre">setEncoding(enc)</span></code> and has the same prohibition against
setting multiple times.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flowing</span></code> Read-only.  Boolean indicating whether a chunk written to the
stream will be immediately emitted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emittedEnd</span></code> Read-only.  Boolean indicating whether the end-ish events
(ie, <code class="docutils literal notranslate"><span class="pre">end</span></code>, <code class="docutils literal notranslate"><span class="pre">prefinish</span></code>, <code class="docutils literal notranslate"><span class="pre">finish</span></code>) have been emitted.  Note that
listening on any end-ish event will immediateyl re-emit it if it has
already been emitted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">writable</span></code> Whether the stream is writable.  Default <code class="docutils literal notranslate"><span class="pre">true</span></code>.  Set to
<code class="docutils literal notranslate"><span class="pre">false</span></code> when <code class="docutils literal notranslate"><span class="pre">end()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">readable</span></code> Whether the stream is readable.  Default <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer</span></code> A <a class="reference external" href="http://npm.im/yallist">yallist</a> linked list of chunks written
to the stream that have not yet been emitted.  (It’s probably a bad idea
to mess with this.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipes</span></code> A <a class="reference external" href="http://npm.im/yallist">yallist</a> linked list of streams that
this stream is piping into.  (It’s probably a bad idea to mess with
this.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destroyed</span></code> A getter that indicates whether the stream was destroyed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paused</span></code> True if the stream has been explicitly paused, otherwise false.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">objectMode</span></code> Indicates whether the stream is in <code class="docutils literal notranslate"><span class="pre">objectMode</span></code>.  Once set
to <code class="docutils literal notranslate"><span class="pre">true</span></code>, it cannot be set to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
</ul>
</div>
<div class="section" id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> Emitted when there’s data to read.  Argument is the data to read.
This is never emitted while not flowing.  If a listener is attached, that
will resume the stream.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end</span></code> Emitted when there’s no more data to read.  This will be emitted
immediately for empty streams when <code class="docutils literal notranslate"><span class="pre">end()</span></code> is called.  If a listener is
attached, and <code class="docutils literal notranslate"><span class="pre">end</span></code> was already emitted, then it will be emitted again.
All listeners are removed when <code class="docutils literal notranslate"><span class="pre">end</span></code> is emitted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefinish</span></code> An end-ish event that follows the same logic as <code class="docutils literal notranslate"><span class="pre">end</span></code> and is
emitted in the same conditions where <code class="docutils literal notranslate"><span class="pre">end</span></code> is emitted.  Emitted after
<code class="docutils literal notranslate"><span class="pre">'end'</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finish</span></code> An end-ish event that follows the same logic as <code class="docutils literal notranslate"><span class="pre">end</span></code> and is
emitted in the same conditions where <code class="docutils literal notranslate"><span class="pre">end</span></code> is emitted.  Emitted after
<code class="docutils literal notranslate"><span class="pre">'prefinish'</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">close</span></code> An indication that an underlying resource has been released.
Minipass does not emit this event, but will defer it until after <code class="docutils literal notranslate"><span class="pre">end</span></code>
has been emitted, since it throws off some stream libraries otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drain</span></code> Emitted when the internal buffer empties, and it is again
suitable to <code class="docutils literal notranslate"><span class="pre">write()</span></code> into the stream.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">readable</span></code> Emitted when data is buffered and ready to be read by a
consumer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume</span></code> Emitted when stream changes state from buffering to flowing
mode.  (Ie, when <code class="docutils literal notranslate"><span class="pre">resume</span></code> is called, <code class="docutils literal notranslate"><span class="pre">pipe</span></code> is called, or a <code class="docutils literal notranslate"><span class="pre">data</span></code> event
listener is added.)</p></li>
</ul>
</div>
<div class="section" id="static-methods">
<h3>Static Methods<a class="headerlink" href="#static-methods" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Minipass.isStream(stream)</span></code> Returns <code class="docutils literal notranslate"><span class="pre">true</span></code> if the argument is a stream,
and false otherwise.  To be considered a stream, the object must be
either an instance of Minipass, or an EventEmitter that has either a
<code class="docutils literal notranslate"><span class="pre">pipe()</span></code> method, or both <code class="docutils literal notranslate"><span class="pre">write()</span></code> and <code class="docutils literal notranslate"><span class="pre">end()</span></code> methods.  (Pretty much any
stream in node-land will return <code class="docutils literal notranslate"><span class="pre">true</span></code> for this.)</p></li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h2>EXAMPLES<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Here are some examples of things you can do with Minipass streams.</p>
<div class="section" id="simple-are-you-done-yet-promise">
<h3>simple “are you done yet” promise<a class="headerlink" href="#simple-are-you-done-yet-promise" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">mp</span><span class="p">.</span><span class="nx">promise</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// stream is finished</span>
<span class="p">},</span> <span class="nx">er</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// stream emitted an error</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="collecting">
<h3>collecting<a class="headerlink" href="#collecting" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">mp</span><span class="p">.</span><span class="nx">collect</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">all</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// all is an array of all the data emitted</span>
  <span class="c1">// encoding is supported in this case, so</span>
  <span class="c1">// so the result will be a collection of strings if</span>
  <span class="c1">// an encoding is specified, or buffers/objects if not.</span>
  <span class="c1">//</span>
  <span class="c1">// In an async function, you may do</span>
  <span class="c1">// const data = await stream.collect()</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="collecting-into-a-single-blob">
<h3>collecting into a single blob<a class="headerlink" href="#collecting-into-a-single-blob" title="Permalink to this headline">¶</a></h3>
<p>This is a bit slower because it concatenates the data into one chunk for
you, but if you’re going to do it yourself anyway, it’s convenient this
way:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">mp</span><span class="p">.</span><span class="nx">concat</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">onebigchunk</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// onebigchunk is a string if the stream</span>
  <span class="c1">// had an encoding set, or a buffer otherwise.</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="iteration">
<h3>iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h3>
<p>You can iterate over streams synchronously or asynchronously in platforms
that support it.</p>
<p>Synchronous iteration will end when the currently available data is
consumed, even if the <code class="docutils literal notranslate"><span class="pre">end</span></code> event has not been reached.  In string and
buffer mode, the data is concatenated, so unless multiple writes are
occurring in the same tick as the <code class="docutils literal notranslate"><span class="pre">read()</span></code>, sync iteration loops will
generally only have a single iteration.</p>
<p>To consume chunks in this way exactly as they have been written, with no
flattening, create the stream with the <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">objectMode:</span> <span class="pre">true</span> <span class="pre">}</span></code> option.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">({</span> <span class="nx">objectMode</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">mp</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span> <span class="c1">// a, b</span>
<span class="p">}</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">mp</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span> <span class="c1">// c, d</span>
<span class="p">}</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="nx">mp</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">mp</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span> <span class="c1">// e</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">letter</span> <span class="k">of</span> <span class="nx">mp</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">letter</span><span class="p">)</span> <span class="c1">// nothing</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Asynchronous iteration will continue until the end event is reached,
consuming all of the data.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minipass</span><span class="p">({</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span> <span class="p">})</span>

<span class="c1">// some source of some data</span>
<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">5</span>
<span class="kr">const</span> <span class="nx">inter</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">--&gt;</span> <span class="mf">0</span><span class="p">)</span>
    <span class="nx">mp</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s1">&#39;foo\n&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">mp</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">inter</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="mf">100</span><span class="p">)</span>

<span class="c1">// consume the data with asynchronous iteration</span>
<span class="nx">async</span> <span class="kd">function</span> <span class="nx">consume</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="nx">await</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">chunk</span> <span class="k">of</span> <span class="nx">mp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s1">&#39;ok&#39;</span>
<span class="p">}</span>

<span class="nx">consume</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">))</span>
<span class="c1">// logs `foo\n` 5 times, and then `ok`</span>
</pre></div>
</div>
</div>
<div class="section" id="subclass-that-console-log-s-everything-written-into-it">
<h3>subclass that <code class="docutils literal notranslate"><span class="pre">console.log()</span></code>s everything written into it<a class="headerlink" href="#subclass-that-console-log-s-everything-written-into-it" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Logger</span> <span class="kr">extends</span> <span class="nx">Minipass</span> <span class="p">{</span>
  <span class="nx">write</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WRITE&#39;</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
    <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">end</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;END&#39;</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
    <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">someSource</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="k">new</span> <span class="nx">Logger</span><span class="p">()).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someDest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="same-thing-but-using-an-inline-anonymous-class">
<h3>same thing, but using an inline anonymous class<a class="headerlink" href="#same-thing-but-using-an-inline-anonymous-class" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// js classes are fun</span>
<span class="nx">someSource</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="k">new</span> <span class="p">(</span><span class="kr">class</span> <span class="kr">extends</span> <span class="nx">Minipass</span> <span class="p">{</span>
    <span class="nx">emit</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="p">...</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// let&#39;s also log events, because debugging some weird thing</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;EMIT&#39;</span><span class="p">,</span> <span class="nx">ev</span><span class="p">)</span>
      <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="p">...</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">write</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;WRITE&#39;</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
      <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">end</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;END&#39;</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
      <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}))</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">someDest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="subclass-that-defers-end-for-some-reason">
<h3>subclass that defers ‘end’ for some reason<a class="headerlink" href="#subclass-that-defers-end-for-some-reason" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">SlowEnd</span> <span class="kr">extends</span> <span class="nx">Minipass</span> <span class="p">{</span>
  <span class="nx">emit</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span> <span class="o">===</span> <span class="s1">&#39;end&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;going to end, hold on a sec&#39;</span><span class="p">)</span>
      <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ok, ready to end now&#39;</span><span class="p">)</span>
        <span class="kr">super</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span>
      <span class="p">},</span> <span class="mf">100</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="transform-that-creates-newline-delimited-json">
<h3>transform that creates newline-delimited JSON<a class="headerlink" href="#transform-that-creates-newline-delimited-json" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">NDJSONEncode</span> <span class="kr">extends</span> <span class="nx">Minipass</span> <span class="p">{</span>
  <span class="nx">write</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// JSON.stringify can throw, emit an error on that</span>
      <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">end</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span> <span class="o">=</span> <span class="nx">obj</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="kc">undefined</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kr">super</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="transform-that-parses-newline-delimited-json">
<h3>transform that parses newline-delimited JSON<a class="headerlink" href="#transform-that-parses-newline-delimited-json" title="Permalink to this headline">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">NDJSONDecode</span> <span class="kr">extends</span> <span class="nx">Minipass</span> <span class="p">{</span>
  <span class="nx">constructor</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// always be in object mode, as far as Minipass is concerned</span>
    <span class="kr">super</span><span class="p">({</span> <span class="nx">objectMode</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_jsonBuffer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="p">}</span>
  <span class="nx">write</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">chunk</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span>
        <span class="k">typeof</span> <span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span>
        <span class="nx">encoding</span> <span class="o">!==</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">chunk</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">isBuffer</span><span class="p">(</span><span class="nx">chunk</span><span class="p">))</span>
      <span class="nx">chunk</span> <span class="o">=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">encoding</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span> <span class="o">=</span> <span class="nx">encoding</span>
    <span class="p">}</span>
    <span class="kr">const</span> <span class="nx">jsonData</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_jsonBuffer</span> <span class="o">+</span> <span class="nx">chunk</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_jsonBuffer</span> <span class="o">=</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">parsed</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">parsed</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
        <span class="k">continue</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span>
      <span class="nx">cb</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AyrtonB/ESDA-Spatial",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./.cache/yarn/v6/npm-minipass-3.1.3-7d42ff1f39635482e15f9cdb53184deebd5815fd-integrity/node_modules/minipass"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ayrton Bourn, Santiago De La Fuente, Clem Attwood, Joanna Kuleszo, Camilo Perico<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>